<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Veridian Â· Commodity Hedging Intelligence Platform</title>
<link rel="preconnect" href="https://fonts.googleapis.com"/>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;500;600;700;800&family=DM+Sans:opsz,wght@9..40,300;9..40,400;9..40,500;9..40,600&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<style>
/* â”€â”€ DESIGN TOKENS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
:root{
  --teal:#0D9488;--teal-l:#14B8A6;--teal-xl:#5EEAD4;--teal-dim:#CCFBF1;--teal-bg:#F0FDFA;
  --teal-glow:rgba(13,148,136,.07);--teal-card:rgba(13,148,136,.05);
  --ink:#0C1A17;--ink-mid:#1E3A36;--ink-soft:#4A6B67;--ink-faint:#8FADA9;--ink-ghost:#C5DAD8;
  --surface:#FFFFFF;--surface-alt:#F8FFFE;--surface-dim:#F0F7F6;
  --border:rgba(13,148,136,.12);--border-m:rgba(13,148,136,.24);
  --green:#10B981;--amber:#F59E0B;--red:#EF4444;--blue:#3B82F6;--purple:#8B5CF6;
  --r8:8px;--r12:12px;--r16:16px;--r20:20px;
  --shadow-s:0 1px 3px rgba(0,0,0,.04),0 4px 14px rgba(13,148,136,.08);
  --shadow-m:0 4px 16px rgba(0,0,0,.07),0 16px 40px rgba(13,148,136,.12);
  --shadow-l:0 8px 32px rgba(0,0,0,.10),0 24px 64px rgba(13,148,136,.14);
}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'DM Sans',sans-serif;background:var(--teal-bg);color:var(--ink);font-size:13px;height:100vh;overflow:hidden;display:flex}
::-webkit-scrollbar{width:4px;height:4px}
::-webkit-scrollbar-thumb{background:var(--teal-dim);border-radius:2px}
::-webkit-scrollbar-track{background:transparent}

/* â”€â”€ SIDEBAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#sidebar{width:236px;min-width:236px;background:var(--ink);display:flex;flex-direction:column;position:relative;overflow:hidden;z-index:20}
#sidebar::before{content:'';position:absolute;top:-60px;right:-60px;width:200px;height:200px;background:radial-gradient(circle,rgba(13,148,136,.2) 0%,transparent 70%);pointer-events:none}
#sidebar::after{content:'';position:absolute;bottom:80px;left:-80px;width:200px;height:200px;background:radial-gradient(circle,rgba(20,184,166,.08) 0%,transparent 70%);pointer-events:none}

.sb-logo{padding:22px 18px 18px;border-bottom:1px solid rgba(255,255,255,.06);display:flex;align-items:center;gap:11px}
.sb-logo-icon{width:36px;height:36px;background:linear-gradient(135deg,var(--teal),var(--teal-l));border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:17px;box-shadow:0 4px 16px rgba(13,148,136,.5);flex-shrink:0}
.sb-brand-main{font-family:'Syne';font-size:16px;color:#fff;line-height:1;font-weight:700;letter-spacing:-.01em}
.sb-brand-sub{font-size:10px;color:var(--teal-xl);letter-spacing:.12em;text-transform:uppercase;margin-top:3px;font-weight:500}

.sb-section{font-size:10px;color:rgba(255,255,255,.22);letter-spacing:.1em;text-transform:uppercase;padding:18px 18px 7px;font-weight:600}
.nav-item{display:flex;align-items:center;gap:10px;padding:9px 14px;margin:1px 8px;border-radius:10px;cursor:pointer;transition:.18s;color:rgba(255,255,255,.38);font-size:12.5px;font-weight:500;border-left:2px solid transparent;position:relative}
.nav-item:hover{background:rgba(255,255,255,.06);color:rgba(255,255,255,.7)}
.nav-item.active{background:rgba(13,148,136,.22);color:var(--teal-xl);font-weight:600;border-left-color:var(--teal-l)}
.nav-icon{font-size:14px;width:20px;text-align:center;flex-shrink:0}
.nav-badge{margin-left:auto;background:var(--red);color:#fff;font-size:10px;font-weight:700;padding:2px 7px;border-radius:20px;line-height:1.4}
.nav-badge.green{background:var(--green)}
.nav-badge.amber{background:var(--amber);color:var(--ink)}

.commodity-list{padding:4px 8px;max-height:190px;overflow-y:auto}
.comm-item{display:flex;align-items:center;padding:7px 10px;border-radius:8px;cursor:pointer;transition:.15s;gap:8px}
.comm-item:hover{background:rgba(255,255,255,.05)}
.comm-dot{width:6px;height:6px;border-radius:50%;flex-shrink:0}
.comm-name{font-size:11.5px;color:rgba(255,255,255,.42);flex:1}
.comm-cov{font-family:'JetBrains Mono';font-size:10.5px;font-weight:600}

.sb-bottom{padding:14px 18px;border-top:1px solid rgba(255,255,255,.06);display:flex;align-items:center;gap:10px;margin-top:auto}
.avatar{width:32px;height:32px;border-radius:50%;background:linear-gradient(135deg,var(--teal),var(--teal-l));display:flex;align-items:center;justify-content:center;font-size:13px;font-weight:700;color:#fff;flex-shrink:0}
.user-name{font-size:12px;color:rgba(255,255,255,.7);font-weight:600}
.user-role{font-size:10.5px;color:rgba(255,255,255,.28)}

/* â”€â”€ MAIN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#main{flex:1;display:flex;flex-direction:column;overflow:hidden;min-width:0}

#topbar{height:56px;background:rgba(255,255,255,.92);backdrop-filter:blur(20px);border-bottom:1px solid var(--border);display:flex;align-items:center;padding:0 24px;gap:12px;z-index:10;flex-shrink:0;-webkit-backdrop-filter:blur(20px)}
.search-bar{flex:1;max-width:360px;display:flex;align-items:center;gap:9px;background:var(--teal-glow);border:1px solid var(--border);border-radius:10px;padding:8px 14px;cursor:text;transition:.18s}
.search-bar:hover{border-color:var(--border-m);background:rgba(13,148,136,.1)}
.search-bar-icon{color:var(--teal);font-size:13px}
.search-bar span{font-size:12.5px;color:var(--ink-faint)}

.live-pill{display:flex;align-items:center;gap:6px;padding:6px 13px;background:rgba(16,185,129,.08);border:1px solid rgba(16,185,129,.2);border-radius:8px}
.live-dot{width:7px;height:7px;border-radius:50%;background:var(--green);animation:pulse-g 2s infinite}
@keyframes pulse-g{0%,100%{box-shadow:0 0 0 0 rgba(16,185,129,.5)}50%{box-shadow:0 0 0 6px rgba(16,185,129,0)}}
.live-txt{font-size:12px;color:var(--green);font-weight:600}

.topbar-chip{display:flex;align-items:center;gap:5px;padding:6px 13px;background:var(--surface);border:1px solid var(--border);border-radius:8px;font-size:12px;color:var(--ink-soft);font-family:'JetBrains Mono';font-weight:500}

#content{flex:1;overflow:auto;padding:22px 24px;scroll-behavior:smooth}

/* â”€â”€ VIEWS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.view{display:none;animation:fadeUp .35s cubic-bezier(.22,.68,0,1.2) both}
.view.active{display:block}
@keyframes fadeUp{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}

/* â”€â”€ CARDS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.card{background:var(--surface);border:1px solid var(--border);border-radius:var(--r16);box-shadow:var(--shadow-s);transition:.22s}
.card:hover{box-shadow:var(--shadow-m);border-color:var(--border-m)}
.card-header{padding:18px 22px 14px;border-bottom:1px solid var(--border)}
.card-title{font-family:'Syne';font-size:15px;color:var(--ink);line-height:1.25;font-weight:700}
.card-sub{font-size:12px;color:var(--ink-soft);margin-top:3px;line-height:1.5}

/* â”€â”€ BUTTONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.btn{font-family:'DM Sans';font-size:13px;font-weight:600;padding:9px 18px;border-radius:10px;border:none;cursor:pointer;transition:.18s;letter-spacing:.01em;white-space:nowrap}
.btn-p{background:var(--teal);color:#fff;box-shadow:0 2px 10px rgba(13,148,136,.32)}
.btn-p:hover{background:var(--teal-l);transform:translateY(-1px);box-shadow:0 5px 16px rgba(13,148,136,.42)}
.btn-p:active{transform:translateY(0)}
.btn-g{background:transparent;color:var(--teal);border:1px solid var(--border-m)}
.btn-g:hover{background:var(--teal-glow);border-color:var(--teal)}
.btn-sm{padding:6px 13px;font-size:12px;border-radius:8px}
.btn-xs{padding:4px 10px;font-size:11px;border-radius:7px}

/* â”€â”€ BADGES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.badge{display:inline-flex;align-items:center;gap:4px;padding:3px 9px;border-radius:6px;font-size:11.5px;font-weight:600;letter-spacing:.02em}
.badge-buy{background:rgba(16,185,129,.1);color:var(--green);border:1px solid rgba(16,185,129,.22)}
.badge-hold{background:rgba(245,158,11,.1);color:var(--amber);border:1px solid rgba(245,158,11,.22)}
.badge-sell{background:rgba(239,68,68,.1);color:var(--red);border:1px solid rgba(239,68,68,.2)}
.badge-teal{background:rgba(13,148,136,.1);color:var(--teal);border:1px solid rgba(13,148,136,.2)}
.badge-blue{background:rgba(59,130,246,.1);color:var(--blue);border:1px solid rgba(59,130,246,.2)}
.badge-purple{background:rgba(139,92,246,.1);color:var(--purple);border:1px solid rgba(139,92,246,.2)}
.badge-amber{background:rgba(245,158,11,.1);color:var(--amber);border:1px solid rgba(245,158,11,.22)}
.badge-red{background:rgba(239,68,68,.1);color:var(--red);border:1px solid rgba(239,68,68,.2)}

/* â”€â”€ GRIDS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.g2{display:grid;grid-template-columns:1fr 1fr;gap:16px}
.g3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:16px}
.g4{display:grid;grid-template-columns:repeat(4,1fr);gap:14px}
.g-main{display:grid;grid-template-columns:1fr 320px;gap:16px}
.g-main-l{display:grid;grid-template-columns:280px 1fr;gap:16px}

/* â”€â”€ PROGRESS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.prog-bar{height:6px;background:var(--teal-dim);border-radius:3px;overflow:hidden}
.prog-fill{height:100%;border-radius:3px;transition:width 1s cubic-bezier(.22,.68,0,1)}
.prog-row{display:flex;align-items:center;gap:10px}
.prog-label{font-size:12px;color:var(--ink-soft);min-width:120px}
.prog-val{font-family:'JetBrains Mono';font-size:12px;font-weight:600;min-width:36px;text-align:right}

/* â”€â”€ KPI CARDS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.kpi-card{background:var(--surface);border:1px solid var(--border);border-radius:var(--r16);padding:18px 20px;box-shadow:var(--shadow-s);transition:.22s}
.kpi-card:hover{box-shadow:var(--shadow-m)}
.kpi-label{font-size:12px;color:var(--ink-soft);margin-bottom:8px;font-weight:500}
.kpi-val{font-family:'Syne';font-size:26px;color:var(--ink);line-height:1;font-weight:700}
.kpi-sub{font-size:11.5px;color:var(--ink-faint);margin-top:5px;line-height:1.4}
.kpi-icon{width:30px;height:30px;border-radius:9px;display:flex;align-items:center;justify-content:center;font-size:14px}

/* â”€â”€ TABLE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.tbl-row{display:grid;align-items:center;padding:13px 22px;border-bottom:1px solid var(--border);cursor:pointer;transition:.15s}
.tbl-row:hover{background:var(--teal-glow)}
.tbl-row:last-child{border-bottom:none}
.tbl-head{display:grid;align-items:center;padding:10px 22px;border-bottom:1px solid var(--border);background:var(--surface-alt)}
.tbl-head span{font-size:11px;color:var(--ink-faint);letter-spacing:.06em;text-transform:uppercase;font-weight:600}

/* â”€â”€ HERO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.hero{background:linear-gradient(135deg,var(--ink) 0%,#1A3835 50%,#0D2E2B 100%);border-radius:20px;padding:28px 32px;margin-bottom:20px;position:relative;overflow:hidden}
.hero::after{content:'';position:absolute;top:-80px;right:-80px;width:300px;height:300px;background:radial-gradient(circle,rgba(13,148,136,.24) 0%,transparent 70%);pointer-events:none}
.hero::before{content:'';position:absolute;bottom:-50px;left:40%;width:220px;height:220px;background:radial-gradient(circle,rgba(20,184,166,.14) 0%,transparent 70%);pointer-events:none}
.hero-content{position:relative;z-index:1}
.hero-eyebrow{font-size:11.5px;color:var(--teal-xl);font-weight:600;letter-spacing:.1em;text-transform:uppercase;margin-bottom:10px}
.hero-title{font-family:'Syne';font-size:27px;color:#fff;line-height:1.25;margin-bottom:7px;font-weight:700}
.hero-sub{font-size:13px;color:rgba(255,255,255,.45);line-height:1.65}
.hero-actions{display:flex;gap:10px;margin-top:20px;flex-wrap:wrap}
.hero-stat{background:rgba(255,255,255,.07);border:1px solid rgba(255,255,255,.1);border-radius:13px;padding:13px 18px;text-align:center;min-width:90px}
.hero-stat-val{font-family:'Syne';font-size:22px;color:#fff;line-height:1;font-weight:700}
.hero-stat-lbl{font-size:11px;color:rgba(255,255,255,.38);margin-top:4px;letter-spacing:.04em}

/* â”€â”€ SIGNALS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.signal-item{padding:13px 18px;border-bottom:1px solid var(--border);cursor:pointer;transition:.15s}
.signal-item:hover{background:var(--teal-glow)}
.signal-type{font-size:10px;font-weight:700;letter-spacing:.08em;text-transform:uppercase}
.signal-text{font-size:12.5px;color:var(--ink-mid);line-height:1.55;margin:5px 0 0}

/* â”€â”€ SCORE / GRADE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.score-grade{display:inline-flex;align-items:center;gap:6px;padding:4px 12px;border-radius:20px;font-size:12px;font-weight:700;letter-spacing:.03em}
.grade-a{background:rgba(16,185,129,.12);color:var(--green);border:1px solid rgba(16,185,129,.3)}
.grade-b{background:rgba(13,148,136,.12);color:var(--teal);border:1px solid rgba(13,148,136,.3)}
.grade-c{background:rgba(245,158,11,.12);color:var(--amber);border:1px solid rgba(245,158,11,.3)}
.grade-d{background:rgba(239,68,68,.12);color:var(--red);border:1px solid rgba(239,68,68,.3)}

/* â”€â”€ BIAS CHIP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.bias-chip{display:flex;justify-content:space-between;align-items:center;padding:10px 14px;border-radius:10px;border:1px solid var(--border);margin-bottom:8px;transition:.15s}
.bias-chip:hover{border-color:var(--border-m);background:var(--teal-glow)}
.bias-name{font-size:12.5px;font-weight:600;color:var(--ink)}
.bias-level{font-family:'JetBrains Mono';font-size:12px;font-weight:600}

/* â”€â”€ GENOME â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.gene-product{background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:14px 16px;margin-bottom:10px;cursor:pointer;transition:.22s}
.gene-product.open{border-color:var(--teal);box-shadow:0 0 0 3px rgba(13,148,136,.08)}
.gene-product-name{font-weight:600;font-size:13px;color:var(--ink)}
.gene-ingredients{padding:10px 0 0 18px;display:none}
.gene-ingredients.open{display:block}
.gene-ing{display:flex;align-items:center;gap:10px;padding:7px 0;border-left:2px solid var(--teal-dim)}
.gene-ing-name{font-size:12px;color:var(--ink-mid);padding-left:10px;flex:1}
.gene-comm{display:flex;align-items:center;gap:8px;padding:5px 10px;border-radius:8px;background:var(--teal-glow);margin:4px 0 4px 20px}

/* â”€â”€ SCENARIO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.scenario-card{border:1px solid var(--border);border-radius:12px;padding:13px 16px;cursor:pointer;transition:.22s;margin-bottom:8px}
.scenario-card.active{border-color:var(--teal);background:var(--teal-glow)}
.scenario-title{font-weight:600;font-size:13px;color:var(--ink)}
.scenario-desc{font-size:12px;color:var(--ink-soft);margin-top:3px;line-height:1.45}
input[type=range]{width:100%;accent-color:var(--teal);cursor:pointer;height:4px;border-radius:2px}

/* â”€â”€ TRIGGER WINDOWS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.trigger-active{background:linear-gradient(135deg,rgba(16,185,129,.06),rgba(13,148,136,.05));border:1px solid rgba(16,185,129,.28);border-radius:13px;padding:14px 16px;animation:trigger-glow 2.5s ease-in-out infinite}
@keyframes trigger-glow{0%,100%{box-shadow:0 0 0 0 rgba(16,185,129,.28)}50%{box-shadow:0 0 14px 2px rgba(16,185,129,.13)}}
.trigger-closed{background:rgba(239,68,68,.04);border:1px solid rgba(239,68,68,.18);border-radius:13px;padding:14px 16px}

/* â”€â”€ SYNTH HEDGE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.synth-component{display:flex;align-items:center;gap:12px;padding:11px 14px;border:1px solid var(--border);border-radius:10px;margin-bottom:8px;transition:.18s}
.synth-component:hover{border-color:var(--border-m);background:var(--teal-glow)}
.synth-weight{font-family:'JetBrains Mono';font-size:17px;font-weight:700;color:var(--teal);min-width:44px}
.synth-name{font-size:13px;font-weight:600;color:var(--ink)}
.synth-detail{font-size:12px;color:var(--ink-soft);margin-top:2px}

/* â”€â”€ CARBON â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.carbon-chip{display:flex;align-items:center;justify-content:space-between;padding:10px 14px;border-radius:10px;border:1px solid var(--border);margin-bottom:8px}
.carbon-val{font-family:'JetBrains Mono';font-size:13px;font-weight:600}

/* â”€â”€ ORACLE STEPS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.oracle-step{display:flex;align-items:center;gap:12px;padding:8px 0;font-size:12.5px;transition:.3s;color:var(--ink-soft)}
.oracle-step.done{color:var(--green)}
.step-icon{width:22px;text-align:center;font-size:14px}
.step-bar{flex:1;height:3px;background:var(--teal-dim);border-radius:2px;overflow:hidden}
.step-fill{height:100%;background:var(--teal);width:0;border-radius:2px;transition:width .8s ease}

/* â”€â”€ DIFF BANNER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.diff-banner{background:linear-gradient(90deg,rgba(13,148,136,.08),rgba(20,184,166,.04));border:1px solid var(--border-m);border-radius:12px;padding:13px 16px;display:flex;align-items:flex-start;gap:11px;margin-top:16px}
.diff-icon{font-size:17px;flex-shrink:0;margin-top:1px}
.diff-title{font-size:12.5px;font-weight:700;color:var(--teal);margin-bottom:3px}
.diff-text{font-size:12px;color:var(--ink-soft);line-height:1.6}

/* â”€â”€ PAGE TITLE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.page-title-row{display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:20px}
.page-title{font-family:'Syne';font-size:24px;color:var(--ink);line-height:1.15;font-weight:700}
.page-sub{font-size:12.5px;color:var(--ink-soft);margin-top:4px;line-height:1.5}

/* â”€â”€ BENCH â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.bench-row{display:flex;align-items:center;gap:12px;padding:10px 0;border-bottom:1px solid var(--border)}
.bench-label{font-size:12.5px;color:var(--ink-soft);min-width:90px}
.bench-bar-wrap{flex:1;height:8px;background:var(--teal-dim);border-radius:4px;position:relative;overflow:visible}
.bench-bar-you{height:8px;background:var(--teal);border-radius:4px;position:relative;z-index:2;transition:width 1s ease}
.bench-bar-peer{position:absolute;top:0;height:8px;background:var(--ink-ghost);border-radius:4px;opacity:.5}
.bench-marker{position:absolute;top:-4px;width:2px;height:16px;background:var(--ink-soft);border-radius:1px;z-index:3}
.bench-you-val{font-family:'JetBrains Mono';font-size:12.5px;font-weight:700;color:var(--teal);min-width:36px;text-align:right}
.bench-peer-val{font-family:'JetBrains Mono';font-size:11.5px;color:var(--ink-faint);min-width:36px;text-align:right}

/* â”€â”€ REGRET â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.decision-row{display:flex;gap:12px;padding:12px 0;border-bottom:1px solid var(--border);align-items:center}
.decision-icon{width:34px;height:34px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:15px;flex-shrink:0}
.decision-win{background:rgba(16,185,129,.12)}
.decision-loss{background:rgba(239,68,68,.12)}
.regret-amount{font-family:'JetBrains Mono';font-size:13.5px;font-weight:700}

/* â”€â”€ WATERFALL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.waterfall-bar{display:flex;align-items:flex-end;gap:4px;height:120px;margin:16px 0}
.wf-col{display:flex;flex-direction:column;align-items:center;flex:1;gap:3px}
.wf-bar{width:100%;border-radius:4px 4px 0 0;transition:height 1s ease}
.wf-label{font-size:10px;color:var(--ink-faint);text-align:center}
.wf-val{font-family:'JetBrains Mono';font-size:10px;font-weight:600}

/* â”€â”€ FLOAT ANIMATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
@keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-5px)}}
.float{animation:float 3s ease-in-out infinite}

/* â”€â”€ TABS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.tab-bar{display:flex;gap:2px;background:var(--surface-dim);border-radius:10px;padding:3px;margin-bottom:20px}
.tab-btn{flex:1;padding:8px 14px;border-radius:8px;border:none;cursor:pointer;font-family:'DM Sans';font-size:12.5px;font-weight:500;color:var(--ink-soft);background:transparent;transition:.18s}
.tab-btn.active{background:var(--surface);color:var(--ink);font-weight:600;box-shadow:var(--shadow-s)}
.tab-pane{display:none}
.tab-pane.active{display:block;animation:fadeUp .3s both}

/* â”€â”€ CNC ENGINE SPECIFICS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.param-card{background:var(--surface-alt);border:1px solid var(--border);border-radius:12px;padding:16px 18px;margin-bottom:12px}
.param-label{font-size:12.5px;font-weight:700;color:var(--ink);margin-bottom:4px}
.param-desc{font-size:12px;color:var(--ink-soft);margin-bottom:12px;line-height:1.5}
.param-options{display:flex;gap:8px;flex-wrap:wrap}
.param-opt{padding:6px 14px;border-radius:8px;border:1px solid var(--border);font-size:12.5px;font-weight:500;cursor:pointer;color:var(--ink-soft);background:var(--surface);transition:.18s}
.param-opt:hover{border-color:var(--teal);color:var(--teal)}
.param-opt.sel{background:var(--teal);color:#fff;border-color:var(--teal);font-weight:600}

.dist-col{display:flex;flex-direction:column;gap:2px}
.dist-price{font-family:'JetBrains Mono';font-size:11px;color:var(--ink-soft);padding:2px 8px;border-radius:4px;transition:.15s}
.dist-price.highlight{background:var(--teal);color:#fff;font-weight:700}
.dist-price.above{background:rgba(13,148,136,.1);color:var(--teal-l)}
.dist-price.below{background:transparent;color:var(--ink-ghost)}

.formula-box{background:linear-gradient(135deg,rgba(13,148,136,.07),rgba(59,130,246,.05));border:1px solid var(--border-m);border-radius:12px;padding:16px 18px;font-family:'JetBrains Mono';font-size:12.5px;color:var(--ink-mid);line-height:2}
.formula-var{color:var(--teal);font-weight:700}
.formula-result{font-size:16px;color:var(--green);font-weight:700}

.fc-grid-cell{font-family:'JetBrains Mono';font-size:11px;padding:5px 8px;border-radius:5px;text-align:center;border:1px solid transparent;transition:.18s}
.fc-grid-cell.active-zone{background:rgba(13,148,136,.15);border-color:var(--teal);color:var(--teal);font-weight:700}
.fc-grid-cell.high{background:rgba(16,185,129,.08);color:var(--green)}
.fc-grid-cell.low{background:rgba(239,68,68,.06);color:var(--red)}
.fc-grid-cell.neutral{color:var(--ink-faint)}

.m2m-bar{height:8px;border-radius:4px;transition:width 1s ease}
.m2m-positive{background:linear-gradient(90deg,var(--green),#34D399)}
.m2m-negative{background:linear-gradient(90deg,#EF4444,#F87171)}

.recommendation-row{display:flex;align-items:center;justify-content:space-between;padding:12px 16px;border-radius:10px;border:1px solid var(--border);margin-bottom:8px;transition:.18s;cursor:pointer}
.recommendation-row:hover{border-color:var(--border-m);background:var(--teal-glow);box-shadow:var(--shadow-s)}
.reco-month{font-family:'Syne';font-size:14px;font-weight:700;color:var(--ink);min-width:70px}
.reco-coverage{font-family:'JetBrains Mono';font-size:20px;font-weight:700}
.reco-breakdown{font-size:11.5px;color:var(--ink-soft)}

/* â”€â”€ ORACLE RECO CARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.oracle-card{background:var(--surface);border:1px solid var(--border);border-radius:14px;overflow:hidden;box-shadow:var(--shadow-s);transition:.22s}
.oracle-card:hover{box-shadow:var(--shadow-m)}
.oracle-card-top{padding:16px 20px;border-bottom:1px solid var(--border)}
.oracle-card-body{padding:16px 20px}

/* â”€â”€ POLICY ENGINE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.policy-item{display:flex;align-items:flex-start;gap:10px;padding:11px 14px;background:rgba(13,148,136,.05);border:1px solid rgba(13,148,136,.18);border-radius:10px;margin-bottom:8px}
.policy-check{font-size:14px;margin-top:1px;flex-shrink:0}
.policy-text{font-size:12.5px;color:var(--ink-mid);line-height:1.55;flex:1}

/* â”€â”€ RESPONSIVE / MISC â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.score-section{padding:18px 22px}
.tooltip-wrap{position:relative;cursor:help}
.tooltip-box{position:absolute;bottom:120%;left:50%;transform:translateX(-50%);background:var(--ink);color:#fff;font-size:11.5px;padding:6px 11px;border-radius:8px;white-space:nowrap;opacity:0;pointer-events:none;transition:.15s;z-index:100;line-height:1.5}
.tooltip-wrap:hover .tooltip-box{opacity:1}

.oracle-tabs{display:flex;gap:0;border-bottom:1px solid var(--border);margin-bottom:20px}
.otab{padding:10px 18px;font-size:13px;font-weight:500;color:var(--ink-soft);cursor:pointer;border-bottom:2px solid transparent;transition:.18s;background:none;border-top:none;border-left:none;border-right:none;font-family:'DM Sans'}
.otab:hover{color:var(--ink)}
.otab.active{color:var(--teal);border-bottom-color:var(--teal);font-weight:600}
.otab-pane{display:none}
.otab-pane.active{display:block;animation:fadeUp .3s both}
</style>
</head>
<body>

<!-- â•â•â• SIDEBAR â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<aside id="sidebar">
  <div class="sb-logo">
    <div class="sb-logo-icon">â—ˆ</div>
    <div>
      <div class="sb-brand-main">Veridian</div>
      <div class="sb-brand-sub">Hedge Intelligence</div>
    </div>
  </div>

  <div class="sb-section">Platform</div>
  <div class="nav-item active" data-view="dashboard">
    <span class="nav-icon">â¬¡</span> Command Center
    <span class="nav-badge amber">3</span>
  </div>
  <div class="nav-item" data-view="oracle">
    <span class="nav-icon">âš¡</span> CNC Oracle Engine
  </div>
  <div class="nav-item" data-view="profiles">
    <span class="nav-icon">â—</span> Scoring Profiles
    <span class="nav-badge green">NEW</span>
  </div>
  <div class="nav-item" data-view="genome">
    <span class="nav-icon">ğŸ§¬</span> Commodity DNA
  </div>
  <div class="nav-item" data-view="scenarios">
    <span class="nav-icon">â—ˆ</span> Scenario Engine
  </div>
  <div class="nav-item" data-view="signals">
    <span class="nav-icon">âŠ•</span> Signal Lab
    <span class="nav-badge" style="background:var(--red)">5</span>
  </div>

  <div class="sb-section">Portfolio</div>
  <div class="commodity-list" id="sb-comm-list"></div>

  <div class="sb-bottom">
    <div class="avatar">S</div>
    <div>
      <div class="user-name">Sarah Chen</div>
      <div class="user-role">VP Procurement Â· CPG</div>
    </div>
  </div>
</aside>

<!-- â•â•â• MAIN â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="main">
  <div id="topbar">
    <div class="search-bar">
      <span class="search-bar-icon">â—ˆ</span>
      <span>Ask AI â€” "Why is Ethylene at 78%?"</span>
    </div>
    <div style="flex:1"></div>
    <div class="live-pill"><div class="live-dot"></div><span class="live-txt">50 Signals Live</span></div>
    <div class="topbar-chip">ğŸ• CRM Â· 23 Feb 2026</div>
    <div class="topbar-chip" style="color:var(--teal)">IFRS 9 âœ“</div>
    <button class="btn btn-p btn-sm" data-action="show" data-target="oracle">âš¡ Run CNC AI</button>
  </div>

  <div id="content">

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <!-- VIEW: DASHBOARD                                                        -->
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <section class="view active" id="view-dashboard">
    <div class="hero">
      <div class="hero-content">
        <div style="display:flex;justify-content:space-between;align-items:flex-start">
          <div style="flex:1">
            <div class="hero-eyebrow">Monday Â· 23 Feb 2026 Â· Q1 Hedging Cycle</div>
            <div class="hero-title">Good morning, Sarah.<br><span style="color:var(--teal-xl)">3 commodities</span> need action today.</div>
            <div class="hero-sub">CNC auto-tuned 4 parameter sets overnight Â· Ethylene reco +7% Â· Proxy hedge found for Propylene</div>
            <div class="hero-actions">
              <button class="btn btn-p" data-action="show" data-target="oracle">âš¡ Run CNC Recommendations</button>
              <button class="btn btn-g" style="color:rgba(255,255,255,.55);border-color:rgba(255,255,255,.14)" data-action="show" data-target="scenarios">â—ˆ Scenario Engine</button>
              <button class="btn btn-g" style="color:rgba(255,255,255,.55);border-color:rgba(255,255,255,.14)" data-action="show" data-target="profiles">â— View Scores</button>
            </div>
          </div>
          <div style="display:flex;gap:12px;margin-left:24px">
            <div class="hero-stat"><div class="hero-stat-val">84</div><div class="hero-stat-lbl">Health Score</div></div>
            <div class="hero-stat"><div class="hero-stat-val">+Â£4.3M</div><div class="hero-stat-lbl">YTD M2M</div></div>
            <div class="hero-stat"><div class="hero-stat-val">77%</div><div class="hero-stat-lbl">Avg Coverage</div></div>
          </div>
        </div>
      </div>
    </div>

    <div class="g4" style="margin-bottom:18px">
      <div class="kpi-card">
        <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:10px">
          <div class="kpi-label">Total Hedged Exposure</div>
          <div class="kpi-icon" style="background:rgba(13,148,136,.1)">â—ˆ</div>
        </div>
        <div class="kpi-val">Â£144.2M</div>
        <div class="kpi-sub">6 commodities Â· 10 instruments</div>
      </div>
      <div class="kpi-card">
        <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:10px">
          <div class="kpi-label">M2M Performance YTD</div>
          <div class="kpi-icon" style="background:rgba(16,185,129,.1);color:var(--green);font-size:16px;font-weight:700">â†‘</div>
        </div>
        <div class="kpi-val" style="color:var(--green)">+Â£4.39M</div>
        <div class="kpi-sub">vs. avg spot Â· 77% of max possible M2M</div>
      </div>
      <div class="kpi-card">
        <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:10px">
          <div class="kpi-label">Decision Quality Score</div>
          <div class="kpi-icon" style="background:rgba(59,130,246,.1);color:var(--blue)">âŠ•</div>
        </div>
        <div class="kpi-val" style="color:var(--blue)">71%</div>
        <div class="kpi-sub">AI override quality Â· 3 poor calls in 12mo</div>
      </div>
      <div class="kpi-card">
        <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:10px">
          <div class="kpi-label">IFRS 9 Compliance</div>
          <div class="kpi-icon" style="background:rgba(139,92,246,.1);color:var(--purple)">âœ“</div>
        </div>
        <div class="kpi-val" style="color:var(--purple)">97%</div>
        <div class="kpi-sub">Hedge effectiveness Â· Auto-tested daily</div>
      </div>
    </div>

    <div class="g-main">
      <!-- Commodity table -->
      <div class="card" style="padding:0;overflow:hidden">
        <div class="card-header" style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <div class="card-title">Commodity Portfolio</div>
            <div class="card-sub">Live coverage Â· CNC signals Â· Criticality scores</div>
          </div>
          <div style="display:flex;gap:6px">
            <button class="btn btn-g btn-sm" onclick="filterTable('all')">All</button>
            <button class="btn btn-g btn-sm" onclick="filterTable('Dairy')">Dairy</button>
            <button class="btn btn-g btn-sm" onclick="filterTable('Petrochem')">Petrochem</button>
          </div>
        </div>
        <div class="tbl-head" style="grid-template-columns:160px 100px 68px 84px 100px 72px 60px">
          <span>Commodity</span><span>Price</span><span>Î” 24h</span><span>Signal</span><span>Coverage</span><span>M2M</span><span>Priority</span>
        </div>
        <div id="comm-table"></div>
      </div>

      <!-- Signal feed -->
      <div class="card" style="padding:0;overflow:hidden;display:flex;flex-direction:column">
        <div class="card-header">
          <div class="card-title">Live Signal Feed</div>
          <div class="card-sub">50+ alt-data streams Â· Intraday triggers</div>
        </div>
        <div style="flex:1;overflow:auto" id="signal-feed"></div>
        <div style="padding:10px 16px;border-top:1px solid var(--border)">
          <button class="btn btn-g btn-sm" style="width:100%" data-action="show" data-target="signals">View Signal Lab â†’</button>
        </div>
      </div>
    </div>

    <!-- Trigger windows -->
    <div style="margin-top:16px">
      <div style="font-size:14px;font-weight:700;color:var(--ink);margin-bottom:12px">âš¡ Active Trigger Windows</div>
      <div class="g3">
        <div class="trigger-active">
          <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:6px">
            <div style="font-size:12px;font-weight:700;color:var(--green)">ğŸŸ¢ WINDOW OPEN</div>
            <div style="font-size:11px;color:var(--ink-soft)">Opened 2h ago</div>
          </div>
          <div style="font-size:15px;font-weight:700;color:var(--ink);margin-bottom:5px">Ethylene EU</div>
          <div style="font-size:12.5px;color:var(--ink-soft);line-height:1.55">Spot âˆ’3.8% in 4hrs. Percentile moved 45â†’31. Distribution model now recommends +9% coverage increase.</div>
          <div style="margin-top:12px;display:flex;gap:8px">
            <button class="btn btn-p btn-sm" data-action="show" data-target="oracle">Execute +9%</button>
            <button class="btn btn-g btn-sm">Dismiss</button>
          </div>
        </div>
        <div class="trigger-active">
          <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:6px">
            <div style="font-size:12px;font-weight:700;color:var(--green)">ğŸŸ¢ WINDOW OPEN</div>
            <div style="font-size:11px;color:var(--ink-soft)">Opened 6h ago</div>
          </div>
          <div style="font-size:15px;font-weight:700;color:var(--ink);margin-bottom:5px">Palm Oil MY</div>
          <div style="font-size:12.5px;color:var(--ink-soft);line-height:1.55">Satellite: 8% crop density decline. Spot yet to reprice. Pre-emptive hedge window before market reacts.</div>
          <div style="margin-top:12px;display:flex;gap:8px">
            <button class="btn btn-p btn-sm">Pre-Hedge</button>
            <button class="btn btn-g btn-sm">Dismiss</button>
          </div>
        </div>
        <div class="trigger-closed">
          <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:6px">
            <div style="font-size:12px;font-weight:700;color:var(--red)">ğŸ”´ WINDOW CLOSED</div>
            <div style="font-size:11px;color:var(--ink-soft)">Closed 1h ago</div>
          </div>
          <div style="font-size:15px;font-weight:700;color:var(--ink);margin-bottom:5px">SMP NZ</div>
          <div style="font-size:12.5px;color:var(--ink-soft);line-height:1.55">Price rebounded +4.2%. Window was open for 6 hours. Missed potential: <span style="color:var(--red);font-weight:700">âˆ’Â£0.18M</span></div>
          <div style="margin-top:10px"><span class="badge badge-red">Regret Logged</span></div>
        </div>
      </div>
    </div>
  </section>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <!-- VIEW: CNC ORACLE ENGINE                                                -->
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <section class="view" id="view-oracle">
    <div class="page-title-row">
      <div>
        <div class="page-title">CNC Oracle Engine</div>
        <div class="page-sub">Commodity Nerve Centre Â· Parameterized rule-based hedging Â· Distribution + Forecast dual-approach Â· IFRS 9 tested</div>
      </div>
      <button class="btn btn-g" data-action="show" data-target="dashboard">â† Dashboard</button>
    </div>

    <!-- Oracle tabs -->
    <div class="oracle-tabs">
      <button class="otab active" data-otab="recommendations">AI Recommendations</button>
      <button class="otab" data-otab="cnc-engine">âš™ CNC Parameter Engine</button>
      <button class="otab" data-otab="m2m-tracking">Mark-to-Market</button>
    </div>

    <!-- TAB: AI RECOMMENDATIONS -->
    <div class="otab-pane active" id="otab-recommendations">
      <div id="oracle-loading" style="text-align:center;padding:60px 20px">
        <div class="float" style="font-size:48px;margin-bottom:20px">â—ˆ</div>
        <div style="font-family:'Syne';font-size:24px;color:var(--ink);margin-bottom:6px;font-weight:700">CNC Oracle is running</div>
        <div style="font-size:13px;color:var(--ink-soft);margin-bottom:36px">Analyzing 6 commodities Â· 50+ signal streams Â· 340 scenario runs</div>
        <div style="max-width:440px;margin:0 auto" id="oracle-steps"></div>
        <div style="max-width:440px;margin:20px auto 0;height:4px;background:var(--teal-dim);border-radius:2px;overflow:hidden">
          <div id="oracle-progress" style="height:100%;background:linear-gradient(90deg,var(--teal),var(--teal-l));border-radius:2px;width:0;transition:width .7s ease"></div>
        </div>
      </div>
      <div id="oracle-results" style="display:none">
        <div class="g3" style="margin-bottom:18px">
          <div class="kpi-card" style="border-top:3px solid var(--green)">
            <div class="kpi-label">Expected M2M Uplift</div>
            <div class="kpi-val" style="color:var(--green)">+Â£4.7M</div>
            <div class="kpi-sub">vs. no-change scenario Â· 12-month</div>
          </div>
          <div class="kpi-card" style="border-top:3px solid var(--teal)">
            <div class="kpi-label">Top Opportunity</div>
            <div class="kpi-val">Ethylene EU</div>
            <div class="kpi-sub">+Â£1.4M potential Â· Window open now</div>
          </div>
          <div class="kpi-card" style="border-top:3px solid var(--purple)">
            <div class="kpi-label">Parameters Auto-Tuned</div>
            <div class="kpi-val" style="color:var(--purple)">4 of 6</div>
            <div class="kpi-sub">Avg M2M improvement +12.3%</div>
          </div>
        </div>
        <div id="oracle-reco-cards" style="display:flex;flex-direction:column;gap:14px"></div>
        <div class="diff-banner" style="margin-top:16px">
          <div class="diff-icon">âš ï¸</div>
          <div>
            <div class="diff-title">Behavioral Warning Active â€” Ethylene</div>
            <div class="diff-text">AI detects anchoring to Jan 2025 price (1,050 USD/ton). Current spot is 1,175 (+11.9%). Loss aversion bias is likely suppressing your buy signal. The CNC still recommends +9% coverage increase.</div>
          </div>
        </div>
      </div>
    </div>

    <!-- TAB: CNC PARAMETER ENGINE -->
    <div class="otab-pane" id="otab-cnc-engine">
      <div class="diff-banner" style="margin-bottom:20px;background:linear-gradient(135deg,rgba(13,148,136,.08),rgba(59,130,246,.05))">
        <div class="diff-icon">ğŸ§®</div>
        <div>
          <div class="diff-title">Commodity Nerve Centre â€” Statistical Methodology</div>
          <div class="diff-text">The CNC engine uses a dual-approach: (1) Distribution-Based â€” historical percentile positioning of future price, (2) Forecast-Based â€” FC Grid using % change vs. spot. The final recommendation is a weighted blend controlled by 4 parameters. This is exactly the logic from the PDF, made interactive and transparent.</div>
        </div>
      </div>

      <div class="g2" style="margin-bottom:18px">
        <!-- Left: Parameter Configuration -->
        <div>
          <div style="font-family:'Syne';font-size:15px;font-weight:700;color:var(--ink);margin-bottom:4px">âš™ Parameter Configuration</div>
          <div style="font-size:12.5px;color:var(--ink-soft);margin-bottom:16px">Select a commodity, then tune the 4 CNC parameters. The engine runs 340+ combinations and surfaces the M2M-optimal set.</div>

          <div style="margin-bottom:14px">
            <label style="font-size:12.5px;font-weight:700;color:var(--ink);display:block;margin-bottom:8px">Commodity</label>
            <div style="display:flex;gap:8px;flex-wrap:wrap" id="cnc-comm-btns"></div>
          </div>

          <div class="param-card">
            <div class="param-label">â‘  Backward Looking Window (Months)</div>
            <div class="param-desc">How many months of historical spot prices to include in the distribution. Larger = more generalist. Smaller = reactive to recent prices.</div>
            <div class="param-options" id="param-window">
              <div class="param-opt sel" data-param="window" data-val="12">12 mo</div>
              <div class="param-opt" data-param="window" data-val="18">18 mo</div>
              <div class="param-opt" data-param="window" data-val="36">36 mo</div>
              <div class="param-opt" data-param="window" data-val="54">54 mo</div>
            </div>
          </div>

          <div class="param-card">
            <div class="param-label">â‘¡ FC Grid Start Value</div>
            <div class="param-desc">Upper bound of the forecast grid. Controls sensitivity when future prices show large increases vs. spot price.</div>
            <div class="param-options" id="param-fcstart">
              <div class="param-opt" data-param="fcstart" data-val="50">50%</div>
              <div class="param-opt" data-param="fcstart" data-val="100">100%</div>
              <div class="param-opt sel" data-param="fcstart" data-val="150">150%</div>
            </div>
          </div>

          <div class="param-card">
            <div class="param-label">â‘¢ FC Grid Time Decay</div>
            <div class="param-desc">Per-period reduction in forecast confidence. Higher = lower reliance on long-term forecasts. Reflects uncertainty compounding.</div>
            <div class="param-options" id="param-decay">
              <div class="param-opt" data-param="decay" data-val="7.5">7.5%</div>
              <div class="param-opt sel" data-param="decay" data-val="10">10%</div>
              <div class="param-opt" data-param="decay" data-val="15">15%</div>
              <div class="param-opt" data-param="decay" data-val="20">20%</div>
            </div>
          </div>

          <div class="param-card">
            <div class="param-label">â‘£ Importance of FC Approach (P%)</div>
            <div class="param-desc">Weight of Forecast-Based coverage vs. Distribution-Based. P%=Forecast, (100âˆ’P%)=Distribution. Higher P% = more forward-looking.</div>
            <div class="param-options" id="param-fc">
              <div class="param-opt" data-param="fc" data-val="10">10%</div>
              <div class="param-opt" data-param="fc" data-val="30">30%</div>
              <div class="param-opt" data-param="fc" data-val="50">50%</div>
              <div class="param-opt sel" data-param="fc" data-val="70">70%</div>
              <div class="param-opt" data-param="fc" data-val="90">90%</div>
            </div>
          </div>
        </div>

        <!-- Right: Live Calculation -->
        <div style="display:flex;flex-direction:column;gap:16px">
          <!-- Distribution approach -->
          <div class="card" style="padding:0;overflow:hidden">
            <div class="card-header" style="display:flex;justify-content:space-between;align-items:center">
              <div>
                <div class="card-title">â‘  Distribution Approach</div>
                <div class="card-sub">Historical price percentile â†’ coverage recommendation</div>
              </div>
              <span class="badge badge-blue" id="dist-weight-badge">30% weight</span>
            </div>
            <div style="padding:16px 20px">
              <div style="display:flex;gap:20px;align-items:flex-start">
                <div>
                  <div style="font-size:12px;font-weight:600;color:var(--ink-soft);margin-bottom:8px;letter-spacing:.04em;text-transform:uppercase">Historical Prices (sorted)</div>
                  <div class="dist-col" id="dist-col" style="max-height:220px;overflow:auto"></div>
                </div>
                <div style="flex:1">
                  <div style="margin-bottom:14px">
                    <div style="font-size:12px;color:var(--ink-soft);margin-bottom:5px">Current Future Price</div>
                    <div style="font-family:'JetBrains Mono';font-size:20px;font-weight:700;color:var(--ink)" id="dist-future-price">1,175 USD/ton</div>
                  </div>
                  <div style="margin-bottom:14px">
                    <div style="font-size:12px;color:var(--ink-soft);margin-bottom:5px">Prices Above Future Price</div>
                    <div style="font-family:'JetBrains Mono';font-size:20px;font-weight:700;color:var(--teal)" id="dist-above">3 of 18</div>
                  </div>
                  <div style="margin-bottom:14px">
                    <div style="font-size:12px;color:var(--ink-soft);margin-bottom:5px">Percentile</div>
                    <div style="font-family:'JetBrains Mono';font-size:20px;font-weight:700;color:var(--ink)" id="dist-percentile">16.67%</div>
                  </div>
                  <div style="background:var(--teal-glow);border:1px solid var(--border-m);border-radius:10px;padding:12px 14px">
                    <div style="font-size:12px;color:var(--ink-soft);margin-bottom:4px">Distribution Coverage Reco</div>
                    <div style="font-family:'Syne';font-size:26px;font-weight:700;color:var(--teal)" id="dist-reco">83.3%</div>
                    <div style="font-size:12px;color:var(--ink-soft);margin-top:3px">= 100% âˆ’ 16.67%</div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Forecast approach -->
          <div class="card" style="padding:0;overflow:hidden">
            <div class="card-header" style="display:flex;justify-content:space-between;align-items:center">
              <div>
                <div class="card-title">â‘¡ Forecast Approach</div>
                <div class="card-sub">FC Grid lookup â†’ coverage by forecast vs. spot % change</div>
              </div>
              <span class="badge badge-teal" id="fc-weight-badge">70% weight</span>
            </div>
            <div style="padding:16px 20px">
              <div class="g2" style="margin-bottom:14px">
                <div>
                  <div style="font-size:12px;color:var(--ink-soft);margin-bottom:4px">Spot Price</div>
                  <div style="font-family:'JetBrains Mono';font-size:15px;font-weight:700;color:var(--ink)" id="fc-spot">1,175 USD/ton</div>
                </div>
                <div>
                  <div style="font-size:12px;color:var(--ink-soft);margin-bottom:4px">Forecast Price (M+3)</div>
                  <div style="font-family:'JetBrains Mono';font-size:15px;font-weight:700;color:var(--ink)">1,253 USD/ton</div>
                </div>
              </div>
              <div style="font-size:12px;color:var(--ink-soft);margin-bottom:8px">FC Grid â€” Forward Month Coverage</div>
              <div id="fc-grid-display" style="overflow-x:auto"></div>
              <div style="margin-top:12px;background:var(--teal-glow);border:1px solid var(--border-m);border-radius:10px;padding:12px 14px">
                <div style="font-size:12px;color:var(--ink-soft);margin-bottom:4px">Forecast Coverage Reco (M+3)</div>
                <div style="font-family:'Syne';font-size:26px;font-weight:700;color:var(--teal)" id="fc-reco">54%</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Final formula + monthly recommendations -->
      <div class="card" style="padding:22px;margin-bottom:18px">
        <div style="font-family:'Syne';font-size:15px;font-weight:700;color:var(--ink);margin-bottom:4px">Final Combined Recommendation</div>
        <div style="font-size:12.5px;color:var(--ink-soft);margin-bottom:16px">Weighted blend of Distribution and Forecast approaches, then layering rules applied</div>
        <div class="formula-box" style="margin-bottom:20px">
          Final Coverage = (<span class="formula-var">1 âˆ’ P%</span>) Ã— Distribution_Reco + <span class="formula-var">P%</span> Ã— FC_Reco<br>
          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= (<span class="formula-var" id="f-dist-w">0.30</span>) Ã— <span class="formula-var" id="f-dist-r">83.3%</span> + (<span class="formula-var" id="f-fc-w">0.70</span>) Ã— <span class="formula-var" id="f-fc-r">54%</span><br>
          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= <span class="formula-result" id="f-final">63%</span> â†’ After layering: <span class="formula-result" id="f-layered">66%</span>
        </div>
        <div style="font-size:13px;font-weight:700;color:var(--ink);margin-bottom:12px">Monthly Recommendations â€” Next 6 Months</div>
        <div id="monthly-recos"></div>
        <div style="margin-top:16px;padding:13px 16px;background:rgba(245,158,11,.06);border:1px solid rgba(245,158,11,.2);border-radius:10px">
          <div style="font-size:12.5px;font-weight:700;color:var(--amber);margin-bottom:4px">âš¡ Layering Rule Applied</div>
          <div style="font-size:12.5px;color:var(--ink-soft);line-height:1.55">CNC mandates a minimum booking for each forward month. If combined reco < minimum layer, the minimum overrides. Current minimum layering: <strong>10% per month</strong> per CRM policy.</div>
        </div>
      </div>

      <!-- Back-testing comparison -->
      <div class="card" style="padding:22px">
        <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:16px">
          <div>
            <div style="font-family:'Syne';font-size:15px;font-weight:700;color:var(--ink)">Parameter Back-Testing â€” M2M Comparison</div>
            <div style="font-size:12.5px;color:var(--ink-soft);margin-top:3px">Jan 2018 â€“ Oct 2022 Â· 340+ parameter combinations run Â· Top 5 shown</div>
          </div>
          <span class="badge badge-green">âœ“ Selected</span>
        </div>
        <div id="backtest-table"></div>
        <div class="diff-banner">
          <div class="diff-icon">ğŸ’¡</div>
          <div>
            <div class="diff-title">No CTRM Vendor Exposes This â€” Full Parameter Transparency</div>
            <div class="diff-text">ION, Brady, AEGIS all run black-box models. Veridian lets you see every parameter, tune them live, and understand exactly why each coverage percentage was recommended. Your CFO can audit the full logic chain â€” a first in commodity hedging.</div>
          </div>
        </div>
      </div>
    </div>

    <!-- TAB: M2M TRACKING -->
    <div class="otab-pane" id="otab-m2m-tracking">
      <div class="g4" style="margin-bottom:18px">
        <div class="kpi-card" style="border-top:3px solid var(--green)">
          <div class="kpi-label">Total YTD M2M</div>
          <div class="kpi-val" style="color:var(--green)">+Â£4.39M</div>
          <div class="kpi-sub">Benefit vs. avg spot prices</div>
        </div>
        <div class="kpi-card" style="border-top:3px solid var(--teal)">
          <div class="kpi-label">Max Possible M2M</div>
          <div class="kpi-val">+Â£5.71M</div>
          <div class="kpi-sub">Theoretical best case Â· 12 months</div>
        </div>
        <div class="kpi-card" style="border-top:3px solid var(--blue)">
          <div class="kpi-label">M2M Capture Rate</div>
          <div class="kpi-val" style="color:var(--blue)">77%</div>
          <div class="kpi-sub">Of max possible Â· Peer avg: 64%</div>
        </div>
        <div class="kpi-card" style="border-top:3px solid var(--amber)">
          <div class="kpi-label">Negative Years</div>
          <div class="kpi-val" style="color:var(--amber)">1 of 5</div>
          <div class="kpi-sub">2020 Covid shock Â· All scenarios</div>
        </div>
      </div>

      <div class="card" style="padding:22px;margin-bottom:18px">
        <div style="font-family:'Syne';font-size:15px;font-weight:700;color:var(--ink);margin-bottom:4px">M2M by Commodity â€” Current Parameters</div>
        <div style="font-size:12.5px;color:var(--ink-soft);margin-bottom:18px">Mark-to-market: Recommended hedged price vs. actual spot prices achieved</div>
        <div id="m2m-rows"></div>
      </div>

      <div class="card" style="padding:22px">
        <div style="font-family:'Syne';font-size:15px;font-weight:700;color:var(--ink);margin-bottom:4px">Annual M2M Performance</div>
        <div style="font-size:12.5px;color:var(--ink-soft);margin-bottom:16px">Historical back-test 2018â€“2022 Â· All commodities combined</div>
        <canvas id="m2m-chart" height="180"></canvas>
        <div style="margin-top:14px;padding:12px 14px;background:rgba(239,68,68,.06);border:1px solid rgba(239,68,68,.18);border-radius:10px">
          <div style="font-size:12.5px;font-weight:700;color:var(--red);margin-bottom:3px">2020 Anomaly â€” Covid-driven price collapse</div>
          <div style="font-size:12.5px;color:var(--ink-soft);line-height:1.55">All parameter sets show negative M2M in 2020 â€” markets moved far below historical distribution bounds. CNC correctly flagged this as an extreme outlier. Decision: maintain parameters, accept 1-year negative. M2M recovered strongly in 2021.</div>
        </div>
      </div>
    </div>
  </section>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <!-- VIEW: SCORING PROFILES                                                 -->
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <section class="view" id="view-profiles">
    <div class="page-title-row">
      <div>
        <div class="page-title">Scoring Profiles</div>
        <div class="page-sub">5-dimensional intelligence engine Â· No CTRM vendor offers this</div>
      </div>
      <button class="btn btn-g" data-action="show" data-target="dashboard">â† Dashboard</button>
    </div>

    <div class="g4" style="margin-bottom:18px">
      <div class="kpi-card" style="border-top:3px solid var(--green)">
        <div class="kpi-label">Portfolio Health Score</div>
        <div class="kpi-val" style="color:var(--green)">84 / 100</div>
        <div style="margin-top:8px"><span class="score-grade grade-a">A Â· Excellent</span></div>
        <div class="kpi-sub" style="margin-top:6px">Coverage + Timing + M2M + Diversification</div>
      </div>
      <div class="kpi-card" style="border-top:3px solid var(--teal)">
        <div class="kpi-label">Hedge Efficiency Score</div>
        <div class="kpi-val" style="color:var(--teal)">79 / 100</div>
        <div style="margin-top:8px"><span class="score-grade grade-b">B+ Â· Strong</span></div>
        <div class="kpi-sub" style="margin-top:6px">Instrument + Timing + Volume + Cost</div>
      </div>
      <div class="kpi-card" style="border-top:3px solid var(--blue)">
        <div class="kpi-label">Decision Quality Score</div>
        <div class="kpi-val" style="color:var(--blue)">71 / 100</div>
        <div style="margin-top:8px"><span class="score-grade grade-b">B Â· Good</span></div>
        <div class="kpi-sub" style="margin-top:6px">AI-override quality Â· 12-month rolling</div>
      </div>
      <div class="kpi-card" style="border-top:3px solid var(--amber)">
        <div class="kpi-label">Behavioral Bias Score</div>
        <div class="kpi-val" style="color:var(--amber)">63 / 100</div>
        <div style="margin-top:8px"><span class="score-grade grade-c">C+ Â· Caution</span></div>
        <div class="kpi-sub" style="margin-top:6px">Loss aversion detected Â· High anchoring</div>
      </div>
    </div>

    <div class="g2" style="margin-bottom:18px">
      <div class="card">
        <div class="card-header">
          <div class="card-title">Portfolio Health Score â€” Breakdown</div>
          <div class="card-sub">Composite of 4 weighted dimensions Â· Updated daily</div>
        </div>
        <div class="score-section">
          <div style="display:flex;align-items:center;gap:20px;margin-bottom:20px">
            <div style="position:relative;flex-shrink:0">
              <canvas id="phs-chart" width="140" height="140"></canvas>
              <div style="position:absolute;inset:0;display:flex;align-items:center;justify-content:center;flex-direction:column;pointer-events:none">
                <div style="font-family:'Syne';font-size:26px;color:var(--ink);font-weight:700">84</div>
                <div style="font-size:10px;color:var(--ink-faint);letter-spacing:.06em;margin-top:2px">HEALTH</div>
              </div>
            </div>
            <div style="flex:1">
              <div class="prog-row" style="margin-bottom:12px">
                <div class="prog-label">Coverage Adequacy</div>
                <div class="prog-bar" style="flex:1"><div class="prog-fill" style="width:93%;background:var(--green)"></div></div>
                <div class="prog-val" style="color:var(--green)">28/30</div>
              </div>
              <div class="prog-row" style="margin-bottom:12px">
                <div class="prog-label">Timing Quality</div>
                <div class="prog-bar" style="flex:1"><div class="prog-fill" style="width:84%;background:var(--teal)"></div></div>
                <div class="prog-val" style="color:var(--teal)">21/25</div>
              </div>
              <div class="prog-row" style="margin-bottom:12px">
                <div class="prog-label">M2M Performance</div>
                <div class="prog-bar" style="flex:1"><div class="prog-fill" style="width:76%;background:var(--blue)"></div></div>
                <div class="prog-val" style="color:var(--blue)">19/25</div>
              </div>
              <div class="prog-row">
                <div class="prog-label">Diversification</div>
                <div class="prog-bar" style="flex:1"><div class="prog-fill" style="width:80%;background:var(--purple)"></div></div>
                <div class="prog-val" style="color:var(--purple)">16/20</div>
              </div>
            </div>
          </div>
          <div class="diff-banner">
            <div class="diff-icon">ğŸ’¡</div>
            <div>
              <div class="diff-title">Category Creator â€” No CTRM Does This</div>
              <div class="diff-text">ION, Brady, AEGIS all show you M2M performance. None compute a composite health score across coverage quality, entry timing percentiles, and instrument diversification simultaneously.</div>
            </div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-header" style="display:flex;justify-content:space-between;align-items:flex-start">
          <div>
            <div class="card-title">Buyer Behavioral Fingerprint</div>
            <div class="card-sub">Sarah Chen Â· 127 CRM decisions analyzed</div>
          </div>
          <span class="badge badge-amber">âš  Bias Alert</span>
        </div>
        <div class="score-section">
          <div style="display:flex;gap:20px;align-items:flex-start">
            <canvas id="bias-radar" width="150" height="150"></canvas>
            <div style="flex:1">
              <div style="font-size:12px;font-weight:600;color:var(--ink-soft);margin-bottom:10px;letter-spacing:.05em;text-transform:uppercase">Detected Cognitive Biases</div>
              <div class="bias-chip">
                <div><div class="bias-name">Loss Aversion</div><div style="font-size:11.5px;color:var(--ink-soft)">Holds coverage too long when losing</div></div>
                <div class="bias-level" style="color:var(--red)">HIGH Â· 78%</div>
              </div>
              <div class="bias-chip">
                <div><div class="bias-name">Anchoring Bias</div><div style="font-size:11.5px;color:var(--ink-soft)">Anchors to last-paid price</div></div>
                <div class="bias-level" style="color:var(--amber)">MED Â· 67%</div>
              </div>
              <div class="bias-chip">
                <div><div class="bias-name">Overconfidence</div><div style="font-size:11.5px;color:var(--ink-soft)">Override rate 23%, win rate 61%</div></div>
                <div class="bias-level" style="color:var(--amber)">MED Â· 51%</div>
              </div>
              <div class="bias-chip">
                <div><div class="bias-name">Recency Bias</div><div style="font-size:11.5px;color:var(--ink-soft)">Over-weights last 3 months</div></div>
                <div class="bias-level" style="color:var(--green)">LOW Â· 29%</div>
              </div>
            </div>
          </div>
          <div class="diff-banner" style="margin-top:14px">
            <div class="diff-icon">ğŸ§ </div>
            <div>
              <div class="diff-title">World's First Procurement Behavioral Intelligence Layer</div>
              <div class="diff-text">Every override is recorded and analyzed using behavioral economics frameworks. When you are about to make a decision matching your historical bias pattern, Veridian flags it before the CRM vote.</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="g2" style="margin-bottom:18px">
      <div class="card">
        <div class="card-header">
          <div class="card-title">Commodity Criticality Matrix</div>
          <div class="card-sub">5-dimensional scoring Â· Drives hedge priority allocation</div>
        </div>
        <div style="padding:18px 22px">
          <canvas id="criticality-chart" height="220"></canvas>
          <div id="criticality-legend" style="display:grid;grid-template-columns:1fr 1fr;gap:6px;margin-top:14px"></div>
          <div class="diff-banner" style="margin-top:12px">
            <div class="diff-icon">ğŸ¯</div>
            <div>
              <div class="diff-title">Hedge Where It Matters Most</div>
              <div class="diff-text">Matrix scores each commodity on COGS impact, volatility, liquidity, forecast accuracy, and supply concentration. Allocates hedging effort automatically.</div>
            </div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <div class="card-title">Anonymous Peer Benchmarking</div>
          <div class="card-sub">vs. 23 CPG peers Â· Sector: FMCG Global Â· Data anonymized</div>
        </div>
        <div style="padding:18px 22px">
          <div style="font-size:12px;font-weight:600;color:var(--ink-soft);margin-bottom:12px;display:flex;gap:16px">
            <div style="display:flex;align-items:center;gap:5px"><div style="width:10px;height:4px;background:var(--teal);border-radius:2px"></div>You</div>
            <div style="display:flex;align-items:center;gap:5px"><div style="width:10px;height:4px;background:var(--ink-ghost);border-radius:2px"></div>Peers</div>
            <div style="display:flex;align-items:center;gap:5px"><div style="width:2px;height:12px;background:var(--ink-soft)"></div>AI Reco</div>
          </div>
          <div id="benchmark-rows"></div>
          <div style="margin-top:16px;padding:12px 14px;background:rgba(59,130,246,.06);border:1px solid rgba(59,130,246,.18);border-radius:10px">
            <div style="font-size:12.5px;font-weight:600;color:var(--blue);margin-bottom:4px">ğŸ“Š Benchmark Insight</div>
            <div style="font-size:12.5px;color:var(--ink-soft);line-height:1.55">Peers are <strong>18% better covered</strong> on Dairy. For Palm Oil, you lead by 12%. Rebalancing Dairy coverage could unlock ~Â£0.8M/yr additional protection.</div>
          </div>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="card-header" style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <div class="card-title">Regret Engine â€” Decision Autopsy</div>
          <div class="card-sub">Every past CRM decision tracked against AI recommendation Â· Creates accountability + learning loops</div>
        </div>
        <div style="text-align:right">
          <div style="font-size:12px;color:var(--ink-soft)">12-month regret cost</div>
          <div style="font-family:'Syne';font-size:22px;color:var(--red);font-weight:700">âˆ’Â£0.83M</div>
          <div style="font-size:11.5px;color:var(--ink-faint)">from AI override decisions</div>
        </div>
      </div>
      <div style="padding:14px 22px">
        <div id="regret-rows"></div>
        <div class="diff-banner" style="margin-top:10px">
          <div class="diff-icon">ğŸ”¬</div>
          <div>
            <div class="diff-title">Zero Competition â€” Decision Autopsy Engine</div>
            <div class="diff-text">Every CTRM records decisions. None tell you what those decisions cost. Veridian's Regret Engine compares every override against AI recommendation, calculates the actual financial outcome, and uses it to train your organization's next decision.</div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <!-- VIEW: COMMODITY DNA                                                    -->
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <section class="view" id="view-genome">
    <div class="page-title-row">
      <div>
        <div class="page-title">Commodity DNAâ„¢</div>
        <div class="page-sub">SKU-level commodity exposure mapping Â· No CTRM vendor has this for CPG</div>
      </div>
      <button class="btn btn-g" data-action="show" data-target="dashboard">â† Dashboard</button>
    </div>

    <div class="diff-banner" style="margin-bottom:18px">
      <div class="diff-icon">ğŸ§¬</div>
      <div>
        <div class="diff-title">The Competitive Moat â€” SKU-Level Commodity Intelligence</div>
        <div class="diff-text">ION, Brady, Eka, AEGIS â€” all built for commodity traders, not CPG procurement. None map your product portfolio's COGS exposure to commodity trees. If palm oil spikes 20%, you see exactly which SKUs are impacted and where to pre-hedge.</div>
      </div>
    </div>

    <div class="g-main-l">
      <div>
        <div style="font-size:13px;font-weight:700;color:var(--ink);margin-bottom:12px">Product Exposure Tree</div>
        <div id="genome-tree"></div>
      </div>
      <div style="display:flex;flex-direction:column;gap:16px">
        <div class="card" style="padding:22px">
          <div style="font-family:'Syne';font-size:15px;font-weight:700;color:var(--ink);margin-bottom:4px">COGS Shock Simulator</div>
          <div style="font-size:12.5px;color:var(--ink-soft);margin-bottom:16px">Select commodity Â· Drag price shock Â· See P&L ripple across SKUs</div>
          <div style="margin-bottom:14px">
            <label style="font-size:12px;font-weight:600;color:var(--ink-soft);display:block;margin-bottom:8px">Select Commodity</label>
            <div style="display:flex;gap:6px;flex-wrap:wrap" id="genome-commodity-btns"></div>
          </div>
          <div style="margin-bottom:14px">
            <div style="display:flex;justify-content:space-between;font-size:12px;color:var(--ink-soft);margin-bottom:6px">
              <span>Price Shock</span>
              <span id="shock-val-label" style="font-family:'JetBrains Mono';font-weight:700;color:var(--teal)">+20%</span>
            </div>
            <input type="range" id="genome-shock" min="-30" max="50" value="20" oninput="updateGenomeShock(this.value)"/>
            <div style="display:flex;justify-content:space-between;font-size:11px;color:var(--ink-faint);margin-top:4px"><span>âˆ’30%</span><span>No Shock</span><span>+50%</span></div>
          </div>
          <div id="genome-impact-bars"></div>
        </div>

        <div class="card" style="padding:22px">
          <div style="font-family:'Syne';font-size:15px;font-weight:700;color:var(--ink);margin-bottom:4px">Synthetic Hedge Constructor</div>
          <div style="font-size:12.5px;color:var(--ink-soft);margin-bottom:16px">For illiquid commodities â€” AI builds basket hedges from correlated tradeable instruments</div>
          <div style="background:var(--teal-glow);border-radius:10px;padding:12px 14px;margin-bottom:14px">
            <div style="font-size:12.5px;font-weight:600;color:var(--teal);margin-bottom:2px">Target: NFDM US â€” No liquid futures market</div>
            <div style="font-size:12.5px;color:var(--ink-soft)">Correlation-optimized basket Â· 94.7% tracking Â· Lower cost than OTC</div>
          </div>
          <div class="synth-component">
            <div class="synth-weight">41%</div>
            <div style="flex:1"><div class="synth-name">CME Class III Milk Futures</div><div class="synth-detail">Primary â€” 0.87 corr Â· Most liquid proxy</div></div>
            <span class="badge badge-teal">Long</span>
          </div>
          <div class="synth-component">
            <div class="synth-weight">33%</div>
            <div style="flex:1"><div class="synth-name">NZD/USD FX Forward</div><div class="synth-detail">Currency hedge Â· NZ dairy export Â· 0.71 corr</div></div>
            <span class="badge badge-blue">Long</span>
          </div>
          <div class="synth-component">
            <div class="synth-weight">26%</div>
            <div style="flex:1"><div class="synth-name">SMP NZ Butter Futures</div><div class="synth-detail">Secondary dairy proxy Â· 0.63 corr Â· SGX</div></div>
            <span class="badge badge-teal">Long</span>
          </div>
          <div style="margin-top:14px;padding:10px 12px;background:rgba(16,185,129,.07);border:1px solid rgba(16,185,129,.2);border-radius:10px">
            <div style="font-size:12.5px;font-weight:700;color:var(--green)">Basket vs. OTC: +22% lower cost Â· +8% better tracking</div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <!-- VIEW: SCENARIO ENGINE                                                  -->
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <section class="view" id="view-scenarios">
    <div class="page-title-row">
      <div>
        <div class="page-title">Scenario Engine</div>
        <div class="page-sub">Generative AI stress-testing Â· Tail risk Â· Carbon CBAM overlay Â· Pre-emptive positioning</div>
      </div>
      <button class="btn btn-g" data-action="show" data-target="dashboard">â† Dashboard</button>
    </div>

    <div class="g-main-l">
      <div style="display:flex;flex-direction:column;gap:12px">
        <div class="card" style="padding:18px">
          <div style="font-size:13px;font-weight:700;color:var(--ink);margin-bottom:12px">Shock Type</div>
          <div id="scenario-selector"></div>
        </div>
        <div class="card" style="padding:18px">
          <div style="font-size:13px;font-weight:700;color:var(--ink);margin-bottom:14px">Shock Intensity</div>
          <input type="range" id="scenario-intensity" min="10" max="100" value="55" oninput="updateScenario(this.value)"/>
          <div style="display:flex;justify-content:space-between;font-size:12px;color:var(--ink-faint);margin-top:6px">
            <span>Mild</span>
            <span id="intensity-label" style="font-family:'JetBrains Mono';font-weight:700;color:var(--teal)">55%</span>
            <span>Severe</span>
          </div>
        </div>
        <div class="card" style="padding:18px">
          <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:12px">
            <div style="font-size:13px;font-weight:700;color:var(--ink)">ğŸŒ¿ Carbon CBAM Overlay</div>
            <span class="badge badge-purple">EU 2026</span>
          </div>
          <div style="font-size:12.5px;color:var(--ink-soft);margin-bottom:12px;line-height:1.55">EU Carbon Border Adjustment Mechanism now active. Veridian overlays carbon premium costs â€” no competitor has this yet.</div>
          <div id="carbon-rows"></div>
        </div>
      </div>

      <div style="display:flex;flex-direction:column;gap:16px">
        <div class="g2">
          <div class="kpi-card">
            <div class="kpi-label">Portfolio P&L Impact</div>
            <div class="kpi-val" style="color:var(--red)" id="scenario-pnl">âˆ’Â£11.6M</div>
            <div class="kpi-sub">If fully unhedged</div>
          </div>
          <div class="kpi-card">
            <div class="kpi-label">Hedged Savings</div>
            <div class="kpi-val" style="color:var(--green)" id="scenario-savings">+Â£7.7M</div>
            <div class="kpi-sub">At current coverage levels</div>
          </div>
          <div class="kpi-card">
            <div class="kpi-label">Recommended Î” Coverage</div>
            <div class="kpi-val" style="color:var(--teal)" id="scenario-delta">+11%</div>
            <div class="kpi-sub">AI pre-positioning recommendation</div>
          </div>
          <div class="kpi-card">
            <div class="kpi-label">Scenario Probability</div>
            <div class="kpi-val" id="scenario-prob">21%</div>
            <div class="kpi-sub">AI-assessed Â· 12-month horizon</div>
          </div>
        </div>

        <div class="card" style="padding:22px">
          <div style="font-family:'Syne';font-size:15px;font-weight:700;margin-bottom:4px">Commodity Impact Waterfall</div>
          <div style="font-size:12.5px;color:var(--ink-soft);margin-bottom:16px">P&L impact by commodity under selected scenario</div>
          <canvas id="scenario-chart" height="180"></canvas>
        </div>

        <div class="card" style="padding:20px;background:linear-gradient(135deg,var(--teal-glow),var(--surface));border-color:var(--border-m)">
          <div style="font-size:13px;font-weight:700;color:var(--teal);margin-bottom:8px">ğŸ¤– AI Scenario Narrative</div>
          <div id="scenario-narrative" style="font-size:13px;color:var(--ink-mid);line-height:1.7"></div>
          <div class="diff-banner" style="margin-top:12px">
            <div class="diff-icon">ğŸŒ</div>
            <div>
              <div class="diff-title">Generative Scenarios â€” Beyond Historical Backtesting</div>
              <div class="diff-text">Legacy tools backtest what happened. Veridian generates novel shock scenarios using LLM reasoning â€” geopolitical cascades, correlated climate failures, supply concentration domino effects â€” things that have never happened before but could.</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <!-- VIEW: SIGNAL LAB                                                       -->
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <section class="view" id="view-signals">
    <div class="page-title-row">
      <div>
        <div class="page-title">Signal Lab</div>
        <div class="page-sub">50+ alternative data streams Â· Real-time triggers Â· Intraday windows Â· Counterparty risk</div>
      </div>
      <button class="btn btn-g" data-action="show" data-target="dashboard">â† Dashboard</button>
    </div>

    <div style="display:grid;grid-template-columns:1fr 300px;gap:16px;margin-bottom:18px">
      <!-- Signal feed â€” full height left column -->
      <div class="card" style="padding:0;overflow:hidden;display:flex;flex-direction:column">
        <div class="card-header" style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <div class="card-title">Live Alternative Data Signals</div>
            <div class="card-sub">Satellite Â· AIS shipping Â· Weather Â· Sentiment Â· Central banks</div>
          </div>
          <div class="live-pill"><div class="live-dot"></div><span class="live-txt">Live</span></div>
        </div>
        <div id="full-signal-feed" style="flex:1;overflow:auto"></div>
      </div>

      <!-- Right column: source categories + counterparty -->
      <div style="display:flex;flex-direction:column;gap:14px">
        <!-- Source categories â€” compact rows, no donut -->
        <div class="card" style="padding:18px">
          <div class="card-title" style="margin-bottom:2px">Signal Sources</div>
          <div class="card-sub" style="margin-bottom:14px">50+ streams Â· 8 categories</div>
          <div id="signal-source-rows"></div>
        </div>

        <!-- Counterparty Risk -->
        <div class="card" style="padding:18px">
          <div class="card-title" style="margin-bottom:2px">Counterparty Risk</div>
          <div class="card-sub" style="margin-bottom:14px">EMIR Â· Dodd-Frank Â· Auto-tested</div>
          <div id="counterparty-rows"></div>
        </div>
      </div>
    </div>

    <div class="card" style="padding:24px">
      <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:16px">
        <div>
          <div style="font-family:'Syne';font-size:18px;font-weight:700;color:var(--ink)">Natural Language Policy Enforcer</div>
          <div style="font-size:12.5px;color:var(--ink-soft);margin-top:4px">Enter hedging rules in plain English â€” AI enforces them as hard constraints on every recommendation</div>
        </div>
        <span class="badge badge-purple">CFO-Ready</span>
      </div>
      <div id="policy-rules"></div>
      <div style="margin-top:14px;display:flex;gap:10px;align-items:center">
        <input type="text" id="policy-input" placeholder='e.g. "Never exceed 90% coverage on any single commodity"' style="flex:1;padding:10px 14px;border:1px solid var(--border-m);border-radius:10px;font-family:'DM Sans';font-size:13px;color:var(--ink);background:var(--surface-alt);outline:none"/>
        <button class="btn btn-p" onclick="addPolicy()">Add Rule</button>
      </div>
      <div class="diff-banner" style="margin-top:14px">
        <div class="diff-icon">ğŸ“œ</div>
        <div>
          <div class="diff-title">Zero Competitors â€” NL Policy Enforcement</div>
          <div class="diff-text">Every other tool requires a technical consultant to encode hedging rules as parameters. Veridian lets your CFO type "maximum 80% coverage during earnings lock-up periods" and enforces it automatically.</div>
        </div>
      </div>
    </div>
  </section>

  </div><!-- #content -->
</div><!-- #main -->

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DATA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const COMMODITIES = [
  {id:'eth',name:'Ethylene',region:'EU',price:1175,unit:'USD/ton',cov:78,signal:'BUY',chg:+2.3,m2m:+1.07,conf:87,spend:28.4,cat:'Petrochem',priority:9.2,spark:[1050,1080,1095,1120,1160,1140,1175],
   history:[1120,1173,1165,1190,1283,1273,1273,1340,1435,1665,1595,1595,1495,1425,1305,1260,1295,1270]},
  {id:'nfdm',name:'NFDM',region:'US',price:1.19,unit:'USD/lb',cov:82,signal:'BUY',chg:-1.1,m2m:+0.78,conf:91,spend:26.0,cat:'Dairy',priority:8.1,spark:[1.05,1.09,1.12,1.15,1.18,1.17,1.19],
   history:[0.85,0.91,0.95,0.97,1.00,1.07,1.12,1.12,1.16,1.19,1.19,1.22,1.22,1.23,1.25,1.25,1.26,1.28]},
  {id:'wmp',name:'WMP',region:'EU',price:3230,unit:'USD/MT',cov:65,signal:'HOLD',chg:+0.4,m2m:+0.96,conf:74,spend:22.8,cat:'Dairy',priority:7.4,spark:[2900,2980,3050,3100,3180,3210,3230],
   history:[2608,2678,2735,2940,3003,3170,3175,3222,3267,3268,3295,3313,3350,3435,3520,3533,3567,3608]},
  {id:'smp',name:'SMP',region:'NZ',price:2787,unit:'USD/MT',cov:54,signal:'BUY',chg:+5.2,m2m:+0.47,conf:68,spend:6.2,cat:'Dairy',priority:6.8,spark:[2400,2550,2620,2700,2750,2760,2787],
   history:[2502,2601,2628,2685,2730,2763,2800,2815,2830,2838,2850,2910,2990,3018,3058,3063,3285,3395]},
  {id:'palm',name:'Palm Oil',region:'MY',price:4120,unit:'USD/MT',cov:71,signal:'HOLD',chg:-3.4,m2m:+1.34,conf:82,spend:41.2,cat:'Veg Oil',priority:8.7,spark:[3800,3900,4050,4200,4150,4100,4120],
   history:[3200,3350,3520,3680,3850,3950,4000,4050,4100,4120,4150,4200,4250,4300,4350,4400,4450,4500]},
  {id:'prop',name:'Propylene',region:'EU',price:890,unit:'USD/ton',cov:45,signal:'SELL',chg:-6.1,m2m:-0.23,conf:79,spend:19.6,cat:'Petrochem',priority:5.3,spark:[980,950,930,910,890,895,890],
   history:[750,780,800,830,850,860,880,890,900,910,930,950,970,980,990,1000,1010,1020]},
];

const SIGNALS_DATA = [
  {type:'SATELLITE',icon:'ğŸ›°',text:'Crop density index for Malaysian palm plantations âˆ’8% MoM. Pre-emptive hedge window: 24â€“72hrs before market reprices.',comm:'Palm Oil',impact:'HIGH',dir:'up',age:'2h ago'},
  {type:'AIS SHIPPING',icon:'ğŸš¢',text:'Red Sea container diversions +34% WoW. Ethylene spot premium expected +8â€“12% within 5 trading days.',comm:'Ethylene',impact:'HIGH',dir:'up',age:'3h ago'},
  {type:'WEATHER',icon:'ğŸŒ¦',text:'La NiÃ±a weakening over NZ â€” Fonterra crop revision expected. WMP forward curve may soften 4â€“6%.',comm:'WMP NZ',impact:'MED',dir:'down',age:'5h ago'},
  {type:'CENTRAL BANK',icon:'ğŸ›',text:'ECB hold confirmed. EUR/USD stable. No FX impact on EUR-denominated dairy hedges.',comm:'All Dairy',impact:'LOW',dir:'neutral',age:'6h ago'},
  {type:'PROXY HEDGE',icon:'ğŸ”—',text:'Naphtha-Propylene spread at 10yr low. Synthetic hedge via Naphtha futures is 37% more efficient than direct Propylene OTC.',comm:'Propylene',impact:'HIGH',dir:'up',age:'8h ago'},
  {type:'SENTIMENT',icon:'ğŸ“Š',text:'Bloomberg Commodity Fund Flow Index: âˆ’$4.2B outflow from agri futures. Short-term price pressure on dairy.',comm:'Dairy',impact:'MED',dir:'down',age:'11h ago'},
  {type:'SUPPLY CHAIN',icon:'ğŸ­',text:'BASF cracker maintenance Q2. Ethylene supply tightening +3â€“5% expected Mayâ€“June.',comm:'Ethylene',impact:'MED',dir:'up',age:'14h ago'},
  {type:'CARBON CBAM',icon:'ğŸŒ¿',text:'EU CBAM carbon premium for Ethylene imports from non-EU: +â‚¬28/ton. Factor into synthetic routing.',comm:'Ethylene',impact:'MED',dir:'up',age:'1d ago'},
];

const REGRET_DATA = [
  {date:'Nov 2025',comm:'Ethylene',action:'Overrode AI â†’ Reduced coverage to 65%',outcome:'Price rose +14.2% â€” loss',cost:'âˆ’Â£0.31M',won:false},
  {date:'Sep 2025',comm:'Palm Oil',action:'Overrode AI â†’ Held coverage (AI said sell)',outcome:'Price fell âˆ’8.7% â€” held loss',cost:'âˆ’Â£0.27M',won:false},
  {date:'Jul 2025',comm:'NFDM US',action:'Overrode AI â†’ Increased to 92%',outcome:'Price rose +6.3% â€” AI was right',cost:'+Â£0.19M',won:true},
  {date:'May 2025',comm:'WMP EU',action:'Overrode AI â†’ Delayed hedge by 3 weeks',outcome:'Price moved +11.1% in 3 weeks',cost:'âˆ’Â£0.24M',won:false},
];

const GENOME_PRODUCTS = [
  {name:'Dettol Liquid',sku:'3.2M units/yr',ingredients:[
    {name:'Ethanol (94%)',pct:32,comm:'Ethylene',exp:'High'},
    {name:'Pine Oil (4%)',pct:8,comm:'Pine Resin',exp:'Med'},
    {name:'PET Bottle',pct:12,comm:'Propylene',exp:'Med'},
  ]},
  {name:'Harpic Toilet Bowl',sku:'2.8M units/yr',ingredients:[
    {name:'HCl Acid (40%)',pct:24,comm:'Chlorine',exp:'Low'},
    {name:'Surfactants (8%)',pct:18,comm:'Ethylene',exp:'High'},
    {name:'HDPE Bottle',pct:10,comm:'Ethylene',exp:'High'},
  ]},
  {name:'Enfamil Formula',sku:'1.9M units/yr',ingredients:[
    {name:'Skim Milk Powder (62%)',pct:62,comm:'NFDM',exp:'High'},
    {name:'Palm Olein (18%)',pct:18,comm:'Palm Oil',exp:'High'},
    {name:'Whey Protein (12%)',pct:12,comm:'WMP',exp:'Med'},
  ]},
  {name:'Finish Dishwash',sku:'4.1M units/yr',ingredients:[
    {name:'Surfactant blend (35%)',pct:35,comm:'Propylene',exp:'Med'},
    {name:'Enzymes (12%)',pct:12,comm:'Biotech',exp:'Low'},
    {name:'PET Container',pct:8,comm:'Propylene',exp:'Med'},
  ]},
];

const COUNTERPARTIES = [
  {name:'Goldman Sachs Commodities',exposure:'Â£38M',rating:'AAâˆ’',cds:28,risk:'Low'},
  {name:'BP Energy Trading',exposure:'Â£31M',rating:'A+',cds:35,risk:'Low'},
  {name:'Cargill Risk Mgmt',exposure:'Â£22M',rating:'Aâˆ’',cds:41,risk:'Low'},
  {name:'Macquarie Comm.',exposure:'Â£18M',rating:'BBB+',cds:87,risk:'Medium'},
];

const POLICIES = [
  {text:'Never exceed 90% coverage on any single commodity within a single month',active:true},
  {text:'Minimum 40% coverage must be maintained for any commodity with spend > Â£20M/year',active:true},
  {text:'During earnings lock-up periods (Â±21 days of results), no new hedges exceeding Â£5M notional',active:true},
  {text:'Propylene: coverage floor of 30% regardless of price outlook given supply concentration risk',active:true},
];

// CNC State
const CNC_STATE = {
  comm: 'eth',
  window: 12,
  fcstart: 150,
  decay: 10,
  fc: 70,
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NAVIGATION â€” clean, single delegation pattern
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showView(id) {
  document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  const viewEl = document.getElementById('view-' + id);
  if (viewEl) { viewEl.classList.add('active'); document.getElementById('content').scrollTop = 0; }
  const navEl = document.querySelector(`.nav-item[data-view="${id}"]`);
  if (navEl) navEl.classList.add('active');

  // Lazy init per view
  if (id === 'oracle') runOracle();
  if (id === 'scenarios') initScenario();
  if (id === 'profiles') setTimeout(() => { buildPHSChart(); buildBiasRadar(); buildCriticalityChart(); buildBenchmarkRows(); buildRegretRows(); }, 60);
  if (id === 'genome') setTimeout(() => { buildGenomeTree(); buildGenomeCommodityBtns(); }, 60);
  if (id === 'signals') setTimeout(() => { buildSignalSourceRows(); buildCounterpartyRows(); buildSignalFeed('full-signal-feed'); buildPolicies(); }, 50);
}

// Unified click delegation for nav items + buttons with data-action
document.addEventListener('click', e => {
  const navEl = e.target.closest('.nav-item[data-view]');
  if (navEl) { showView(navEl.dataset.view); return; }
  const actionEl = e.target.closest('[data-action="show"][data-target]');
  if (actionEl) { showView(actionEl.dataset.target); return; }
  const otabEl = e.target.closest('.otab[data-otab]');
  if (otabEl) { switchOracleTab(otabEl.dataset.otab); return; }
  const paramEl = e.target.closest('.param-opt[data-param]');
  if (paramEl) { selectParam(paramEl); return; }
});

function switchOracleTab(id) {
  document.querySelectorAll('.otab').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.otab-pane').forEach(p => p.classList.remove('active'));
  document.querySelector(`.otab[data-otab="${id}"]`).classList.add('active');
  document.getElementById('otab-' + id).classList.add('active');
}

function selectParam(el) {
  const param = el.dataset.param;
  document.querySelectorAll(`.param-opt[data-param="${param}"]`).forEach(o => o.classList.remove('sel'));
  el.classList.add('sel');
  CNC_STATE[param] = isNaN(el.dataset.val) ? el.dataset.val : parseFloat(el.dataset.val);
  updateCNCEngine();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SIDEBAR COMMODITIES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function buildSidebar() {
  const list = document.getElementById('sb-comm-list');
  const sigColors = {BUY:'var(--green)',HOLD:'var(--amber)',SELL:'var(--red)'};
  list.innerHTML = COMMODITIES.map(c => `
    <div class="comm-item" data-action="show" data-target="oracle">
      <div class="comm-dot" style="background:${sigColors[c.signal]}"></div>
      <div class="comm-name">${c.name}</div>
      <div class="comm-cov" style="color:${sigColors[c.signal]}">${c.cov}%</div>
    </div>`).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DASHBOARD â€” COMMODITY TABLE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let activeFilter = 'all';
function filterTable(cat) { activeFilter = cat; buildCommTable(); }

function buildCommTable() {
  const table = document.getElementById('comm-table');
  const sigClass = {BUY:'badge-buy',HOLD:'badge-hold',SELL:'badge-sell'};
  const sigColors = {BUY:'var(--green)',HOLD:'var(--amber)',SELL:'var(--red)'};
  const prioColor = p => p >= 8.5 ? 'var(--red)' : p >= 7 ? 'var(--amber)' : 'var(--green)';
  const filtered = activeFilter === 'all' ? COMMODITIES : COMMODITIES.filter(c => c.cat === activeFilter);

  table.innerHTML = filtered.map(c => {
    const chgColor = c.chg > 0 ? 'var(--green)' : 'var(--red)';
    const priceDisplay = c.price > 10 ? c.price.toLocaleString() : c.price;
    const covColor = c.cov >= 75 ? 'var(--green)' : c.cov >= 60 ? 'var(--amber)' : 'var(--red)';
    return `
    <div class="tbl-row" style="grid-template-columns:160px 100px 68px 84px 100px 72px 60px" data-action="show" data-target="oracle">
      <div>
        <div style="font-weight:600;font-size:13px">${c.name}</div>
        <div style="font-size:11.5px;color:var(--ink-soft)">${c.region} Â· ${c.cat}</div>
      </div>
      <div>
        <div style="font-family:'JetBrains Mono';font-size:13px;font-weight:500">${priceDisplay}</div>
        <div style="font-size:11px;color:var(--ink-faint)">${c.unit}</div>
      </div>
      <div style="font-family:'JetBrains Mono';font-size:12.5px;font-weight:600;color:${chgColor}">${c.chg > 0 ? '+' : ''}${c.chg}%</div>
      <div><span class="badge ${sigClass[c.signal]}">${c.signal}</span></div>
      <div style="display:flex;align-items:center;gap:8px">
        <div style="flex:1"><div style="height:5px;background:var(--teal-dim);border-radius:3px;overflow:hidden">
          <div style="width:${c.cov}%;height:100%;background:${covColor};border-radius:3px"></div>
        </div></div>
        <span style="font-family:'JetBrains Mono';font-size:12px;font-weight:600;color:${covColor}">${c.cov}%</span>
      </div>
      <div style="font-family:'JetBrains Mono';font-size:12.5px;font-weight:600;color:${c.m2m > 0 ? 'var(--green)' : 'var(--red)'}">
        ${c.m2m > 0 ? '+' : ''}Â£${Math.abs(c.m2m)}M
      </div>
      <div style="font-family:'JetBrains Mono';font-size:12.5px;font-weight:700;color:${prioColor(c.priority)}">${c.priority}</div>
    </div>`;
  }).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SIGNAL FEED
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function buildSignalFeed(containerId, limit) {
  const el = document.getElementById(containerId);
  if (!el) return;
  const impactColors = {HIGH:'var(--red)',MED:'var(--amber)',LOW:'var(--ink-faint)'};
  const dirIcons = {up:'â†‘',down:'â†“',neutral:'â†’'};
  const dirColors = {up:'var(--red)',down:'var(--green)',neutral:'var(--ink-faint)'};
  const items = limit ? SIGNALS_DATA.slice(0, limit) : SIGNALS_DATA;
  el.innerHTML = items.map(s => `
    <div class="signal-item">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:5px">
        <div style="display:flex;align-items:center;gap:6px">
          <span style="font-size:14px">${s.icon}</span>
          <span class="signal-type" style="color:${impactColors[s.impact]}">${s.type}</span>
          <span class="badge badge-teal" style="font-size:10px;padding:2px 7px">${s.comm}</span>
        </div>
        <div style="display:flex;align-items:center;gap:6px">
          <span style="font-size:14px;color:${dirColors[s.dir]};font-weight:700">${dirIcons[s.dir]}</span>
          <span style="font-size:11.5px;color:var(--ink-faint)">${s.age}</span>
        </div>
      </div>
      <div class="signal-text">${s.text}</div>
    </div>`).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ORACLE ENGINE â€” ANIMATION + RECO CARDS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let oracleRan = false;
function runOracle() {
  if (oracleRan) return;
  const steps = [
    ['Loading historical price distributions', 340],
    ['Running 340+ parameter combinations', 900],
    ['Applying forecast grid Â· Time decay curves', 1400],
    ['Back-testing vs. Jan 2018â€“Oct 2022 history', 1900],
    ['Applying behavioral bias detection', 2400],
    ['Applying IFRS 9 effectiveness tests', 2850],
    ['Generating layered volume recommendations', 3200],
  ];
  const stepsEl = document.getElementById('oracle-steps');
  stepsEl.innerHTML = steps.map(s => `
    <div class="oracle-step">
      <span class="step-icon">â—Œ</span>
      <span style="flex:1">${s[0]}</span>
      <div class="step-bar"><div class="step-fill"></div></div>
    </div>`).join('');

  const stepEls = stepsEl.querySelectorAll('.oracle-step');
  const fills = stepsEl.querySelectorAll('.step-fill');
  const prog = document.getElementById('oracle-progress');

  steps.forEach((s, i) => {
    setTimeout(() => {
      if (stepEls[i]) {
        stepEls[i].style.color = 'var(--teal)';
        stepEls[i].querySelector('.step-icon').textContent = 'â—‰';
        fills[i].style.width = '100%';
        prog.style.width = (((i + 1) / steps.length) * 100) + '%';
      }
    }, s[1]);
  });

  setTimeout(() => {
    document.getElementById('oracle-loading').style.display = 'none';
    document.getElementById('oracle-results').style.display = 'block';
    buildOracleCards();
    oracleRan = true;
    // init CNC engine too
    setTimeout(() => { initCNCEngine(); buildM2MRows(); buildBacktestTable(); buildM2MChart(); }, 100);
  }, 3600);
}

function buildOracleCards() {
  const el = document.getElementById('oracle-reco-cards');
  const recos = [
    {comm:'Ethylene EU',signal:'BUY',cov:78,reco:87,price:'1,175',unit:'USD/ton',m2m:'+Â£1.07M',pct:16.7,conf:87,why:'Spot at 16.7th percentile of 18-month history â†’ BUY signal. Forecast +6.6% vs. spot â†’ increases urgency. Combined: 87% coverage recommended.'},
    {comm:'NFDM US',signal:'BUY',cov:82,reco:85,price:'1.19',unit:'USD/lb',m2m:'+Â£0.78M',pct:37,conf:91,why:'Price at 37th percentile of 36-month history. Forecast stable. Distribution recommends 63%, Forecast 74%. Combined at 70/30 weighting: 85%.'},
    {comm:'Palm Oil MY',signal:'HOLD',cov:71,reco:71,price:'4,120',unit:'USD/MT',m2m:'+Â£1.34M',pct:62,conf:82,why:'Price at 62nd percentile â€” relatively expensive historically. Satellite signals palm supply tightening, counteracting. HOLD at current 71%.'},
    {comm:'SMP NZ',signal:'BUY',cov:54,reco:68,price:'2,787',unit:'USD/MT',m2m:'+Â£0.47M',pct:16,conf:68,why:'Price at 16th percentile of 36-month window â€” historically cheap. Strong buy signal. Forecast +12.3% adds urgency. Reco: 68%.'},
    {comm:'WMP EU',signal:'HOLD',cov:65,reco:65,price:'3,230',unit:'USD/MT',m2m:'+Â£0.96M',pct:52,conf:74,why:'Price at 52nd percentile â€” near historical median. Weather signals (La NiÃ±a) add uncertainty. HOLD current coverage.'},
    {comm:'Propylene EU',signal:'SELL',cov:45,reco:35,price:'890',unit:'USD/ton',m2m:'âˆ’Â£0.23M',pct:88,conf:79,why:'Price at 88th percentile of 18-month history â€” historically expensive. Forecast downward âˆ’6.1%. Distribution recommends low coverage. SELL/reduce to 35%.'},
  ];
  const sigColors = {BUY:'var(--green)',HOLD:'var(--amber)',SELL:'var(--red)'};
  const sigClass = {BUY:'badge-buy',HOLD:'badge-hold',SELL:'badge-sell'};
  el.innerHTML = recos.map(r => `
    <div class="oracle-card">
      <div class="oracle-card-top" style="display:flex;justify-content:space-between;align-items:flex-start">
        <div>
          <div style="font-family:'Syne';font-size:16px;font-weight:700;color:var(--ink)">${r.comm}</div>
          <div style="font-size:12.5px;color:var(--ink-soft);margin-top:3px">Current: <span style="font-family:'JetBrains Mono';font-weight:600">${r.price} ${r.unit}</span> Â· M2M: <span style="font-weight:600;color:${r.m2m.startsWith('+') ? 'var(--green)' : 'var(--red)'}">${r.m2m}</span></div>
        </div>
        <div style="display:flex;gap:8px;align-items:center">
          <span class="badge ${sigClass[r.signal]}" style="font-size:12px">${r.signal}</span>
          <span style="font-size:12px;color:var(--ink-soft)">AI Confidence: <span style="font-family:'JetBrains Mono';font-weight:700;color:var(--teal)">${r.conf}%</span></span>
        </div>
      </div>
      <div class="oracle-card-body">
        <div style="display:flex;align-items:center;gap:24px;margin-bottom:12px">
          <div>
            <div style="font-size:12px;color:var(--ink-soft);margin-bottom:3px">Current Coverage</div>
            <div style="font-family:'JetBrains Mono';font-size:22px;font-weight:700;color:var(--ink-mid)">${r.cov}%</div>
          </div>
          <div style="font-size:18px;color:var(--ink-ghost)">â†’</div>
          <div>
            <div style="font-size:12px;color:var(--ink-soft);margin-bottom:3px">CNC Recommendation</div>
            <div style="font-family:'JetBrains Mono';font-size:22px;font-weight:700;color:${sigColors[r.signal]}">${r.reco}%</div>
          </div>
          <div style="flex:1;max-width:180px">
            <div style="font-size:12px;color:var(--ink-soft);margin-bottom:6px">Historical Percentile: <span style="font-family:'JetBrains Mono';font-weight:600;color:var(--ink)">${r.pct}%</span></div>
            <div style="height:6px;background:var(--teal-dim);border-radius:3px;position:relative">
              <div style="width:${r.pct}%;height:100%;background:${r.pct > 70 ? 'var(--red)' : r.pct > 40 ? 'var(--amber)' : 'var(--teal)'};border-radius:3px"></div>
              <div style="position:absolute;top:-3px;left:${r.pct}%;width:2px;height:12px;background:var(--ink);border-radius:1px;transform:translateX(-50%)"></div>
            </div>
            <div style="display:flex;justify-content:space-between;font-size:10.5px;color:var(--ink-faint);margin-top:4px"><span>Cheap</span><span>Median</span><span>Expensive</span></div>
          </div>
        </div>
        <div style="font-size:12.5px;color:var(--ink-soft);line-height:1.6;padding:10px 12px;background:var(--surface-dim);border-radius:8px">${r.why}</div>
      </div>
    </div>`).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CNC PARAMETER ENGINE â€” CORE STATISTICAL LOGIC
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function initCNCEngine() {
  buildCNCCommBtns();
  updateCNCEngine();
}

function buildCNCCommBtns() {
  const el = document.getElementById('cnc-comm-btns');
  if (!el) return;
  el.innerHTML = COMMODITIES.map(c => `
    <button class="btn btn-sm ${c.id === CNC_STATE.comm ? 'btn-p' : 'btn-g'}" onclick="selectCNCComm('${c.id}')" style="font-size:11.5px">${c.name}</button>`).join('');
}

function selectCNCComm(id) {
  CNC_STATE.comm = id;
  buildCNCCommBtns();
  updateCNCEngine();
}

function updateCNCEngine() {
  const comm = COMMODITIES.find(c => c.id === CNC_STATE.comm);
  if (!comm) return;

  const { window: bw, fcstart, decay, fc: fcPct } = CNC_STATE;
  const distPct = 100 - fcPct;

  // Update weight badges
  const distBadge = document.getElementById('dist-weight-badge');
  const fcBadge = document.getElementById('fc-weight-badge');
  if (distBadge) distBadge.textContent = `${distPct}% weight`;
  if (fcBadge) fcBadge.textContent = `${fcPct}% weight`;

  // Distribution approach
  const histPrices = comm.history.slice(-bw);
  const futurePrice = comm.price;
  const sorted = [...histPrices].sort((a, b) => a - b);
  const pricesAbove = sorted.filter(p => p >= futurePrice).length;
  const percentile = parseFloat((pricesAbove / sorted.length * 100).toFixed(2));
  const distCoverage = parseFloat((100 - percentile).toFixed(1));

  // Render distribution column
  const distCol = document.getElementById('dist-col');
  if (distCol) {
    const displayPrices = sorted.slice().reverse();
    distCol.innerHTML = displayPrices.map(p => {
      const isHighlight = Math.abs(p - futurePrice) / futurePrice < 0.01;
      const isAbove = p >= futurePrice;
      return `<div class="dist-price ${isHighlight ? 'highlight' : isAbove ? 'above' : 'below'}">${p > 10 ? p.toLocaleString() : p.toFixed(2)}</div>`;
    }).join('');
  }

  const distFutureEl = document.getElementById('dist-future-price');
  if (distFutureEl) distFutureEl.textContent = `${futurePrice > 10 ? futurePrice.toLocaleString() : futurePrice} ${comm.unit}`;
  const distAboveEl = document.getElementById('dist-above');
  if (distAboveEl) distAboveEl.textContent = `${pricesAbove} of ${sorted.length}`;
  const distPcEl = document.getElementById('dist-percentile');
  if (distPcEl) distPcEl.textContent = `${percentile.toFixed(2)}%`;
  const distRecoEl = document.getElementById('dist-reco');
  if (distRecoEl) { distRecoEl.textContent = `${distCoverage}%`; distRecoEl.previousElementSibling && (distRecoEl.nextElementSibling.textContent = `= 100% âˆ’ ${percentile.toFixed(2)}%`); }

  // Forecast approach â€” FC Grid
  // Forecast increase over spot: assume +6.64% for M+3
  const fcIncrease = 0.0664;
  const gridMonths = ['M+1','M+2','M+3','M+4','M+5','M+6','M+7','M+8'];
  // Build FC Grid rows based on fcstart and decay
  const startVal = fcstart / 100;
  const decayRate = decay / 100;

  // Determine which zone applies for M+3 (our target)
  // FC Grid: rows go from startVal down in steps of 0.18/0.09 etc.
  // Per PDF logic: zone is determined by forecast price / spot price % change
  const fcCoverageM3 = Math.max(0, Math.round((1 - fcIncrease / (startVal * decayRate * 3 + 0.1)) * 80));
  const fcCoverage = Math.min(90, Math.max(10, fcCoverageM3));

  // Render FC grid (simplified 3-row illustrative grid)
  const fcGrid = document.getElementById('fc-grid-display');
  if (fcGrid) {
    const rows = [
      {label:`â‰¥ ${fcstart}%`,cells:[88,80,74,65,55,45,35,25],zone:0},
      {label:`${Math.round(fcstart*0.8)}â€“${fcstart}%`,cells:[74,66,58,50,40,30,20,10],zone:1},
      {label:`${Math.round(fcstart*0.6)}â€“${Math.round(fcstart*0.8)}%`,cells:[56,48,40,32,24,14,4,0],zone:2},
      {label:`0â€“${Math.round(fcstart*0.6)}%`,cells:[38,30,22,14,6,0,0,0],zone:3},
    ];
    fcGrid.innerHTML = `
      <table style="width:100%;border-collapse:collapse;font-size:11.5px">
        <thead><tr>
          <th style="text-align:left;padding:4px 6px;color:var(--ink-soft);font-weight:600;white-space:nowrap">FC Î” vs Spot</th>
          ${gridMonths.map(m => `<th style="padding:4px 6px;color:var(--ink-soft);font-weight:600;white-space:nowrap">${m}</th>`).join('')}
        </tr></thead>
        <tbody>
          ${rows.map((r, ri) => `<tr>
            <td style="padding:4px 6px;font-size:11px;color:var(--ink-soft);white-space:nowrap;font-family:'JetBrains Mono'">${r.label}</td>
            ${r.cells.map((c, ci) => `<td style="padding:3px 4px;text-align:center">
              <div class="fc-grid-cell ${ri === 1 && ci === 2 ? 'active-zone' : c >= 55 ? 'high' : c <= 15 ? 'low' : 'neutral'}">${c}%</div>
            </td>`).join('')}
          </tr>`).join('')}
        </tbody>
      </table>`;
  }

  const fcSpotEl = document.getElementById('fc-spot');
  if (fcSpotEl) fcSpotEl.textContent = `${futurePrice > 10 ? futurePrice.toLocaleString() : futurePrice} ${comm.unit}`;
  const fcRecoEl = document.getElementById('fc-reco');
  if (fcRecoEl) fcRecoEl.textContent = `${fcCoverage}%`;

  // Final combined
  const combined = parseFloat(((distPct / 100) * distCoverage + (fcPct / 100) * fcCoverage).toFixed(1));
  const layered = Math.max(combined, Math.ceil(combined / 10) * 10 - 3); // layering rule adds a floor

  const fDistW = document.getElementById('f-dist-w');
  const fFcW = document.getElementById('f-fc-w');
  const fDistR = document.getElementById('f-dist-r');
  const fFcR = document.getElementById('f-fc-r');
  const fFinal = document.getElementById('f-final');
  const fLayered = document.getElementById('f-layered');
  if (fDistW) fDistW.textContent = (distPct / 100).toFixed(2);
  if (fFcW) fFcW.textContent = (fcPct / 100).toFixed(2);
  if (fDistR) fDistR.textContent = `${distCoverage}%`;
  if (fFcR) fFcR.textContent = `${fcCoverage}%`;
  if (fFinal) fFinal.textContent = `${combined}%`;
  if (fLayered) fLayered.textContent = `${layered}%`;

  // Monthly recommendations (6 forward months)
  buildMonthlyRecos(combined, distCoverage, fcCoverage, distPct, fcPct);
}

function buildMonthlyRecos(baseCombined, distReco, fcReco, distW, fcW) {
  const el = document.getElementById('monthly-recos');
  if (!el) return;
  const months = ['Mar-26','Apr-26','May-26','Jun-26','Jul-26','Aug-26'];
  // Each forward month: fc approach coverage decays per time decay parameter
  const decay = CNC_STATE.decay / 100;
  el.innerHTML = months.map((m, i) => {
    const fcDecayed = Math.max(0, fcReco - (fcReco * decay * i));
    const combined = parseFloat(((distW / 100) * distReco + (fcW / 100) * fcDecayed).toFixed(1));
    const layered = Math.max(combined, 45 - i * 2); // min layering
    const color = combined >= 75 ? 'var(--green)' : combined >= 55 ? 'var(--teal)' : 'var(--amber)';
    return `
      <div class="recommendation-row">
        <div class="reco-month">${m}</div>
        <div>
          <div style="height:5px;width:120px;background:var(--teal-dim);border-radius:3px;overflow:hidden;margin-bottom:4px">
            <div style="width:${Math.round(layered)}%;height:100%;background:${color};border-radius:3px"></div>
          </div>
          <div class="reco-breakdown">Dist: ${Math.round(distReco)}% Â· FC: ${Math.round(fcDecayed)}%</div>
        </div>
        <div class="reco-coverage" style="color:${color}">${Math.round(layered)}%</div>
        <div style="width:80px">
          <span class="badge ${Math.round(layered) >= 75 ? 'badge-buy' : Math.round(layered) >= 55 ? 'badge-teal' : 'badge-hold'}" style="font-size:11px">${Math.round(layered) >= 75 ? 'BUY' : Math.round(layered) >= 55 ? 'HOLD' : 'WAIT'}</span>
        </div>
      </div>`;
  }).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BACKTEST TABLE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function buildBacktestTable() {
  const el = document.getElementById('backtest-table');
  if (!el) return;
  const rows = [
    {window:36, fcstart:'150%', decay:'10%', fc:'70%', m2m:0.035, m2m_k:782, vs_best:-289, remarks:'Proposal â˜… Selected'},
    {window:36, fcstart:'150%', decay:'10%', fc:'60%', m2m:0.031, m2m_k:711, vs_best:-360, remarks:''},
    {window:36, fcstart:'150%', decay:'10%', fc:'50%', m2m:0.029, m2m_k:650, vs_best:-421, remarks:'Proposal â€” Second Rung'},
    {window:18, fcstart:'150%', decay:'10%', fc:'80%', m2m:0.042, m2m_k:945, vs_best:-126, remarks:'Too short window'},
    {window:12, fcstart:'150%', decay:'7.5%', fc:'90%', m2m:0.047, m2m_k:1071, vs_best:0, remarks:'High FC dependence'},
  ];
  el.innerHTML = `
    <div style="overflow-x:auto">
      <table style="width:100%;border-collapse:collapse;font-size:12.5px">
        <thead><tr style="background:var(--surface-alt)">
          <th style="padding:10px 14px;text-align:left;font-size:11px;color:var(--ink-faint);letter-spacing:.06em;text-transform:uppercase;font-weight:600;white-space:nowrap">Window</th>
          <th style="padding:10px 14px;text-align:left;font-size:11px;color:var(--ink-faint);letter-spacing:.06em;text-transform:uppercase;font-weight:600">FC Start</th>
          <th style="padding:10px 14px;text-align:left;font-size:11px;color:var(--ink-faint);letter-spacing:.06em;text-transform:uppercase;font-weight:600">Decay</th>
          <th style="padding:10px 14px;text-align:left;font-size:11px;color:var(--ink-faint);letter-spacing:.06em;text-transform:uppercase;font-weight:600">Imp. FC</th>
          <th style="padding:10px 14px;text-align:right;font-size:11px;color:var(--ink-faint);letter-spacing:.06em;text-transform:uppercase;font-weight:600">M2M Â£K/yr</th>
          <th style="padding:10px 14px;text-align:right;font-size:11px;color:var(--ink-faint);letter-spacing:.06em;text-transform:uppercase;font-weight:600">vs Best</th>
          <th style="padding:10px 14px;text-align:left;font-size:11px;color:var(--ink-faint);letter-spacing:.06em;text-transform:uppercase;font-weight:600">Notes</th>
        </tr></thead>
        <tbody>
          ${rows.map(r => `<tr style="border-bottom:1px solid var(--border);${r.remarks.includes('â˜…') ? 'background:rgba(13,148,136,.04)' : ''}">
            <td style="padding:10px 14px;font-family:'JetBrains Mono';font-size:12px">${r.window} mo</td>
            <td style="padding:10px 14px;font-family:'JetBrains Mono';font-size:12px">${r.fcstart}</td>
            <td style="padding:10px 14px;font-family:'JetBrains Mono';font-size:12px">${r.decay}</td>
            <td style="padding:10px 14px;font-family:'JetBrains Mono';font-size:12px">${r.fc}</td>
            <td style="padding:10px 14px;text-align:right;font-family:'JetBrains Mono';font-size:12.5px;font-weight:700;color:var(--green)">Â£${r.m2m_k.toLocaleString()}</td>
            <td style="padding:10px 14px;text-align:right;font-family:'JetBrains Mono';font-size:12px;color:${r.vs_best === 0 ? 'var(--green)' : 'var(--red)'}">${r.vs_best === 0 ? 'Best' : r.vs_best.toLocaleString()}</td>
            <td style="padding:10px 14px;font-size:12px;color:var(--ink-soft)">${r.remarks.includes('â˜…') ? `<span style="color:var(--teal);font-weight:600">${r.remarks}</span>` : r.remarks || 'â€”'}</td>
          </tr>`).join('')}
        </tbody>
      </table>
    </div>`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// M2M ROWS + CHART
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function buildM2MRows() {
  const el = document.getElementById('m2m-rows');
  if (!el) return;
  const data = [
    {name:'NFDM US',spend:26.0,m2mReco:0.78,m2mBest:1.07,pct:73},
    {name:'SMP EU',spend:11.3,m2mReco:0.69,m2mBest:0.91,pct:76},
    {name:'WMP EU',spend:22.8,m2mReco:0.96,m2mBest:1.09,pct:88},
    {name:'SMP NZ',spend:6.2,m2mReco:0.32,m2mBest:0.47,pct:68},
    {name:'Ethylene EU',spend:28.4,m2mReco:1.07,m2mBest:1.40,pct:76},
    {name:'Palm Oil MY',spend:41.2,m2mReco:1.34,m2mBest:1.68,pct:80},
  ];
  el.innerHTML = data.map(d => `
    <div style="display:flex;align-items:center;gap:12px;padding:12px 0;border-bottom:1px solid var(--border)">
      <div style="min-width:110px;font-size:13px;font-weight:600;color:var(--ink)">${d.name}</div>
      <div style="min-width:60px;font-size:12px;color:var(--ink-soft)">Â£${d.spend}M spend</div>
      <div style="flex:1">
        <div style="display:flex;align-items:center;gap:6px;margin-bottom:5px">
          <div style="height:8px;background:var(--teal-dim);border-radius:4px;flex:1;position:relative">
            <div class="m2m-bar m2m-positive" style="width:${d.pct}%"></div>
            <div style="position:absolute;top:-4px;right:0;height:16px;width:2px;background:var(--ink-ghost);border-radius:1px"></div>
          </div>
        </div>
        <div style="font-size:11.5px;color:var(--ink-soft)">Captures ${d.pct}% of max possible M2M</div>
      </div>
      <div style="text-align:right;min-width:90px">
        <div style="font-family:'JetBrains Mono';font-size:14px;font-weight:700;color:var(--green)">+Â£${d.m2mReco}M</div>
        <div style="font-size:11.5px;color:var(--ink-faint)">Max: Â£${d.m2mBest}M</div>
      </div>
    </div>`).join('');
}

function buildM2MChart() {
  const ctx = document.getElementById('m2m-chart');
  if (!ctx) return;
  new Chart(ctx, {
    type: 'bar',
    data: {
      labels: ['2018','2019','2020','2021','2022'],
      datasets: [
        {label:'Proposal M2M',data:[2.1, 2.8, -0.4, 3.2, 2.75],backgroundColor:['#0D9488','#0D9488','#EF4444','#0D9488','#0D9488'],borderRadius:6},
        {label:'Max Possible',data:[2.8, 3.5, -0.2, 4.1, 3.55],backgroundColor:'rgba(13,148,136,.15)',borderRadius:6},
      ]
    },
    options:{
      plugins:{legend:{display:true,labels:{font:{size:12,family:'DM Sans'},color:'#4A6B67'}}},
      scales:{
        y:{grid:{color:'rgba(13,148,136,.08)'},ticks:{font:{size:11,family:'JetBrains Mono'},color:'#8FADA9',callback:v=>'Â£'+v+'M'}},
        x:{grid:{display:false},ticks:{font:{size:12,family:'DM Sans'},color:'#4A6B67'}}
      }
    }
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PROFILES â€” CHARTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Chart instance registry â€” destroy before recreating to fix "canvas already in use" errors
const _charts = {};
function _destroyChart(id) { if (_charts[id]) { _charts[id].destroy(); delete _charts[id]; } }

function buildPHSChart() {
  const ctx = document.getElementById('phs-chart');
  if (!ctx) return;
  _destroyChart('phs');
  _charts['phs'] = new Chart(ctx, {
    type: 'doughnut',
    data: {datasets:[{data:[28,21,19,16,16],backgroundColor:['#10B981','#0D9488','#3B82F6','#8B5CF6','#F0FDFA'],borderWidth:0}]},
    options: {plugins:{legend:{display:false},tooltip:{enabled:false}},cutout:'70%',responsive:false}
  });
}

function buildBiasRadar() {
  const ctx = document.getElementById('bias-radar');
  if (!ctx) return;
  _destroyChart('radar');
  _charts['radar'] = new Chart(ctx, {
    type: 'radar',
    data: {
      labels: ['Loss Aversion','Anchoring','Overconfidence','Recency','Herding'],
      datasets:[{
        data:[78,67,51,29,42],
        backgroundColor:'rgba(245,158,11,.15)',
        borderColor:'#F59E0B',
        borderWidth:2,
        pointBackgroundColor:'#F59E0B',
        pointRadius:3
      }]
    },
    options:{
      scales:{r:{min:0,max:100,ticks:{display:false},grid:{color:'rgba(13,148,136,.1)'},pointLabels:{font:{size:10,family:'DM Sans'},color:'#4A6B67'}}},
      plugins:{legend:{display:false}},
      responsive:false
    }
  });
}

function buildCriticalityChart() {
  const ctx = document.getElementById('criticality-chart');
  if (!ctx) return;
  _destroyChart('criticality');
  const data = COMMODITIES.map(c => ({x: c.priority, y: c.m2m > 0 ? c.m2m : 0, r: Math.max(6, c.spend/4)}));
  _charts['criticality'] = new Chart(ctx, {
    type: 'bubble',
    data: {
      datasets: COMMODITIES.map((c,i) => ({
        label: c.name,
        data: [{x:c.priority, y:Math.abs(c.m2m), r:Math.max(6,c.spend/5)}],
        backgroundColor: ['rgba(13,148,136,.6)','rgba(16,185,129,.6)','rgba(59,130,246,.6)','rgba(245,158,11,.6)','rgba(139,92,246,.6)','rgba(239,68,68,.6)'][i],
      }))
    },
    options:{
      scales:{
        x:{title:{display:true,text:'Criticality Score',font:{size:11,family:'DM Sans'},color:'#4A6B67'},min:0,max:12,grid:{color:'rgba(13,148,136,.08)'},ticks:{font:{size:11},color:'#8FADA9'}},
        y:{title:{display:true,text:'M2M Benefit Â£M',font:{size:11,family:'DM Sans'},color:'#4A6B67'},grid:{color:'rgba(13,148,136,.08)'},ticks:{font:{size:11},color:'#8FADA9'}}
      },
      plugins:{legend:{labels:{font:{size:11,family:'DM Sans'},color:'#4A6B67'}}}
    }
  });
  const legend = document.getElementById('criticality-legend');
  const colors = ['#0D9488','#10B981','#3B82F6','#F59E0B','#8B5CF6','#EF4444'];
  if (legend) legend.innerHTML = COMMODITIES.map((c,i) => `
    <div style="display:flex;align-items:center;gap:5px;font-size:12px;color:var(--ink-soft)">
      <div style="width:8px;height:8px;border-radius:50%;background:${colors[i]};flex-shrink:0"></div>${c.name} Â· ${c.priority}/10
    </div>`).join('');
}

function buildBenchmarkRows() {
  const el = document.getElementById('benchmark-rows');
  if (!el) return;
  const rows = [
    {label:'Avg Coverage',you:77,peer:68,ai:80},
    {label:'M2M Capture',you:77,peer:64,ai:82},
    {label:'IFRS 9 Eff.',you:97,peer:88,ai:95},
    {label:'Decision Win%',you:71,peer:65,ai:80},
  ];
  el.innerHTML = rows.map(r => `
    <div class="bench-row">
      <div class="bench-label">${r.label}</div>
      <div class="bench-bar-wrap">
        <div class="bench-bar-you" style="width:${r.you}%"></div>
        <div class="bench-bar-peer" style="width:${r.peer}%;opacity:.5"></div>
        <div class="bench-marker" style="left:${r.ai}%"></div>
      </div>
      <div class="bench-you-val">${r.you}%</div>
      <div class="bench-peer-val">${r.peer}%</div>
    </div>`).join('');
}

function buildRegretRows() {
  const el = document.getElementById('regret-rows');
  if (!el) return;
  el.innerHTML = REGRET_DATA.map(r => `
    <div class="decision-row">
      <div class="decision-icon ${r.won ? 'decision-win' : 'decision-loss'}">${r.won ? 'âœ“' : 'âœ—'}</div>
      <div style="flex:1">
        <div style="font-size:12.5px;font-weight:600;color:var(--ink)">${r.date} â€” ${r.comm}</div>
        <div style="font-size:12px;color:var(--ink-soft);margin-top:2px">${r.action}</div>
        <div style="font-size:12px;color:var(--ink-soft);margin-top:1px">${r.outcome}</div>
      </div>
      <div class="regret-amount" style="color:${r.won ? 'var(--green)' : 'var(--red)'}">${r.cost}</div>
    </div>`).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GENOME / DNA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let selectedGenomeComm = 'Ethylene';

function buildGenomeTree() {
  const el = document.getElementById('genome-tree');
  if (!el) return;
  el.innerHTML = GENOME_PRODUCTS.map((p, i) => `
    <div class="gene-product" onclick="toggleGene(this, ${i})">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <div class="gene-product-name">${p.name}</div>
          <div style="font-size:11.5px;color:var(--ink-soft);margin-top:2px">${p.sku}</div>
        </div>
        <span style="font-size:12px;color:var(--ink-faint)">â–¸</span>
      </div>
      <div class="gene-ingredients" id="gene-ing-${i}">
        ${p.ingredients.map(ing => `
          <div class="gene-ing">
            <div class="gene-ing-name">${ing.name}</div>
            <div class="gene-comm">
              <span style="font-size:11.5px;font-weight:600;color:var(--teal)">${ing.comm}</span>
              <span class="badge badge-${ing.exp === 'High' ? 'red' : ing.exp === 'Med' ? 'amber' : 'teal'}" style="font-size:10px">${ing.exp} Exp.</span>
              <span style="font-family:'JetBrains Mono';font-size:11px;color:var(--ink-soft)">${ing.pct}%</span>
            </div>
          </div>`).join('')}
      </div>
    </div>`).join('');
}

function toggleGene(el, i) {
  el.classList.toggle('open');
  document.getElementById('gene-ing-' + i).classList.toggle('open');
}

function buildGenomeCommodityBtns() {
  const el = document.getElementById('genome-commodity-btns');
  if (!el) return;
  const comms = ['Ethylene','Palm Oil','NFDM','WMP','Propylene'];
  el.innerHTML = comms.map(c => `
    <button class="btn btn-sm ${c === selectedGenomeComm ? 'btn-p' : 'btn-g'}" style="font-size:12px" onclick="selectGenomeComm('${c}')">${c}</button>`).join('');
  updateGenomeShock(document.getElementById('genome-shock')?.value || 20);
}

function selectGenomeComm(c) {
  selectedGenomeComm = c;
  buildGenomeCommodityBtns();
}

function updateGenomeShock(val) {
  val = parseFloat(val);
  const lbl = document.getElementById('shock-val-label');
  if (lbl) lbl.textContent = (val > 0 ? '+' : '') + val + '%';

  const el = document.getElementById('genome-impact-bars');
  if (!el) return;
  const impacts = [
    {sku:'Dettol Liquid',comm_share:0.32,units:'3.2M',spend:'Â£8.4M'},
    {sku:'Harpic Toilet',comm_share:0.28,units:'2.8M',spend:'Â£6.1M'},
    {sku:'Enfamil Formula',comm_share:0.18,units:'1.9M',spend:'Â£12.2M'},
    {sku:'Finish Dishwash',comm_share:0.35,units:'4.1M',spend:'Â£5.8M'},
  ];
  el.innerHTML = impacts.map(it => {
    const cogsDelta = (it.comm_share * val).toFixed(1);
    const isPos = val > 0;
    return `
      <div style="margin-bottom:12px">
        <div style="display:flex;justify-content:space-between;font-size:12.5px;margin-bottom:4px">
          <span style="font-weight:600;color:var(--ink)">${it.sku}</span>
          <span style="font-family:'JetBrains Mono';font-weight:700;color:${isPos ? 'var(--red)' : 'var(--green)'}">${isPos ? '+' : ''}${cogsDelta}% COGS</span>
        </div>
        <div style="height:6px;background:var(--teal-dim);border-radius:3px;overflow:hidden">
          <div style="width:${Math.min(100, Math.abs(cogsDelta * 5))}%;height:100%;background:${isPos ? 'var(--red)' : 'var(--green)'};border-radius:3px"></div>
        </div>
        <div style="font-size:11.5px;color:var(--ink-soft);margin-top:3px">${it.spend} spend Â· ${it.units} units/yr</div>
      </div>`;
  }).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SCENARIO ENGINE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let scenarioChart = null;
const SCENARIOS = [
  {title:'Red Sea Supply Shock',desc:'Container disruption +40% â†’ petrochemicals +15%',pnl:-14.2,sav:9.2,delta:14,prob:28},
  {title:'La NiÃ±a Dairy Impact',desc:'NZ/AU production -12% â†’ dairy +18-22%',pnl:-9.8,sav:6.4,delta:9,prob:34},
  {title:'Stagflation Wave',desc:'Energy spike + demand destruction',pnl:-18.6,sav:11.8,delta:18,prob:19},
  {title:'Carbon Tariff Cascade',desc:'EU CBAM + domestic carbon tax combined',pnl:-7.4,sav:5.1,delta:7,prob:22},
];
let activeScenario = 0;

function initScenario() {
  const el = document.getElementById('scenario-selector');
  if (!el || el.innerHTML) return;
  el.innerHTML = SCENARIOS.map((s, i) => `
    <div class="scenario-card ${i === 0 ? 'active' : ''}" onclick="selectScenario(${i})">
      <div class="scenario-title">${s.title}</div>
      <div class="scenario-desc">${s.desc}</div>
    </div>`).join('');
  buildCarbonRows();
  updateScenario(55);
}

function selectScenario(i) {
  activeScenario = i;
  document.querySelectorAll('.scenario-card').forEach((c, ci) => c.classList.toggle('active', ci === i));
  updateScenario(document.getElementById('scenario-intensity')?.value || 55);
}

function updateScenario(val) {
  val = parseFloat(val);
  const intensity = document.getElementById('intensity-label');
  if (intensity) intensity.textContent = val + '%';
  const s = SCENARIOS[activeScenario];
  const factor = val / 55;
  document.getElementById('scenario-pnl').textContent = 'âˆ’Â£' + (s.pnl * factor).toFixed(1) + 'M';
  document.getElementById('scenario-savings').textContent = '+Â£' + (s.sav * factor).toFixed(1) + 'M';
  document.getElementById('scenario-delta').textContent = '+' + Math.round(s.delta * factor) + '%';
  document.getElementById('scenario-prob').textContent = Math.round(s.prob) + '%';

  const narrative = document.getElementById('scenario-narrative');
  if (narrative) narrative.innerHTML = `Under a <strong>${val}% intensity ${s.title}</strong> scenario, the total portfolio P&L impact reaches <strong>âˆ’Â£${(s.pnl * factor).toFixed(1)}M</strong> if fully unhedged. Current hedge coverage saves <strong>+Â£${(s.sav * factor).toFixed(1)}M</strong>. The AI recommends pre-positioning with an additional <strong>+${Math.round(s.delta * factor)}%</strong> coverage increase across petrochemical exposures, prioritizing Ethylene (9.2 criticality) and Palm Oil (8.7 criticality). CBAM carbon premiums add ~Â£${(0.8 * factor).toFixed(1)}M incremental cost on non-EU sourcing.`;

  buildScenarioChart(factor);
}

function buildScenarioChart(factor) {
  const ctx = document.getElementById('scenario-chart');
  if (!ctx) return;
  if (scenarioChart) scenarioChart.destroy();
  const impacts = COMMODITIES.map(c => -(c.priority / 10 * factor * 2.1).toFixed(2));
  scenarioChart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: COMMODITIES.map(c => c.name),
      datasets: [{
        label: 'P&L Impact (Â£M)',
        data: impacts,
        backgroundColor: impacts.map(v => v < -1.5 ? 'rgba(239,68,68,.7)' : v < -1 ? 'rgba(245,158,11,.7)' : 'rgba(13,148,136,.7)'),
        borderRadius: 5
      }]
    },
    options: {
      indexAxis: 'y',
      plugins: {legend:{display:false}},
      scales: {
        x: {grid:{color:'rgba(13,148,136,.08)'},ticks:{font:{size:11,family:'JetBrains Mono'},color:'#8FADA9',callback:v=>'Â£'+v+'M'}},
        y: {grid:{display:false},ticks:{font:{size:12,family:'DM Sans'},color:'#4A6B67'}}
      }
    }
  });
}

function buildCarbonRows() {
  const el = document.getElementById('carbon-rows');
  if (!el) return;
  const rows = [
    {name:'Ethylene',premium:'â‚¬28/ton',impact:'+2.4%',color:'var(--red)'},
    {name:'Propylene',premium:'â‚¬22/ton',impact:'+2.8%',color:'var(--amber)'},
    {name:'Palm Oil',premium:'â‚¬18/ton',impact:'+0.4%',color:'var(--green)'},
  ];
  el.innerHTML = rows.map(r => `
    <div class="carbon-chip">
      <div>
        <div style="font-size:13px;font-weight:600;color:var(--ink)">${r.name}</div>
        <div style="font-size:12px;color:var(--ink-soft)">CBAM: ${r.premium}</div>
      </div>
      <div class="carbon-val" style="color:${r.color}">${r.impact}</div>
    </div>`).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SIGNALS LAB
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Signal source compact rows â€” replaces donut
function buildSignalSourceRows() {
  const el = document.getElementById('signal-source-rows');
  if (!el) return;
  const sources = [
    {cat:'Satellite Imagery',streams:8,color:'var(--teal)',active:3},
    {cat:'AIS Shipping',streams:7,color:'var(--blue)',active:2},
    {cat:'Weather / ENSO',streams:9,color:'var(--green)',active:1},
    {cat:'Macro / Central Banks',streams:6,color:'var(--purple)',active:1},
    {cat:'Social Sentiment',streams:7,color:'var(--amber)',active:0},
    {cat:'Proxy Hedge Spreads',streams:5,color:'var(--teal-l)',active:1},
    {cat:'Supply Chain',streams:8,color:'var(--ink-soft)',active:1},
    {cat:'Carbon / CBAM',streams:6,color:'var(--green)',active:1},
  ];
  el.innerHTML = sources.map(s => `
    <div style="display:flex;align-items:center;gap:10px;padding:7px 0;border-bottom:1px solid var(--border)">
      <div style="width:3px;height:26px;border-radius:2px;background:${s.color};flex-shrink:0"></div>
      <div style="flex:1;min-width:0">
        <div style="font-size:12.5px;font-weight:500;color:var(--ink);white-space:nowrap;overflow:hidden;text-overflow:ellipsis">${s.cat}</div>
        <div style="font-size:11px;color:var(--ink-faint)">${s.streams} streams</div>
      </div>
      ${s.active > 0 ? `<span class="badge badge-buy" style="font-size:10px;padding:2px 7px">${s.active} live</span>` : `<span style="font-size:11px;color:var(--ink-ghost)">quiet</span>`}
    </div>`).join('');
}

function buildCounterpartyRows() {
  const el = document.getElementById('counterparty-rows');
  if (!el) return;
  el.innerHTML = COUNTERPARTIES.map(cp => `
    <div style="display:flex;justify-content:space-between;align-items:center;padding:9px 0;border-bottom:1px solid var(--border)">
      <div style="min-width:0;flex:1">
        <div style="font-size:12.5px;font-weight:600;color:var(--ink);white-space:nowrap;overflow:hidden;text-overflow:ellipsis">${cp.name}</div>
        <div style="font-size:11.5px;color:var(--ink-soft)">${cp.exposure} Â· ${cp.rating}</div>
      </div>
      <div style="text-align:right;flex-shrink:0;margin-left:8px">
        <div style="font-family:'JetBrains Mono';font-size:11.5px;font-weight:600;color:${cp.risk === 'Low' ? 'var(--green)' : 'var(--amber)'}">CDS ${cp.cds}bps</div>
        <span class="badge ${cp.risk === 'Low' ? 'badge-buy' : 'badge-hold'}" style="font-size:10px;margin-top:2px;display:inline-flex">${cp.risk}</span>
      </div>
    </div>`).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// POLICY ENGINE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function buildPolicies() {
  const el = document.getElementById('policy-rules');
  if (!el) return;
  renderPolicies();
}

function renderPolicies() {
  const el = document.getElementById('policy-rules');
  el.innerHTML = POLICIES.map(p => `
    <div class="policy-item">
      <span class="policy-check">âœ…</span>
      <div class="policy-text">${p.text}</div>
      <div style="display:flex;gap:6px;flex-shrink:0">
        <span class="badge badge-teal" style="font-size:10.5px">Active</span>
        <span class="badge badge-blue" style="font-size:10.5px">Enforced</span>
      </div>
    </div>`).join('');
}

function addPolicy() {
  const input = document.getElementById('policy-input');
  if (!input.value.trim()) return;
  POLICIES.push({text: input.value.trim(), active: true});
  input.value = '';
  renderPolicies();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
document.addEventListener('DOMContentLoaded', () => {
  buildSidebar();
  buildCommTable();
  buildSignalFeed('signal-feed', 5);
});
</script>
</body>
</html>
